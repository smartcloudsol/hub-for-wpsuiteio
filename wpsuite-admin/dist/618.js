"use strict";(globalThis.webpackChunk_smart_cloud_wpsuite_admin=globalThis.webpackChunk_smart_cloud_wpsuite_admin||[]).push([[618],{5618:(e,t,n)=>{n.d(t,{default:()=>Z});var s=n(548),i=n(7286),o=n(9095),a=n(6886),r=n(1609),c=n(6427),l=n(7723),d=n(8790),u=n(8948),h=n(8927),m=(n(1880),n(6252)),p=n(8438),x=n(6496),g=n(5841),j=n(6705),b=n(7641),y=n(7693),f=n(3737),w=n(8365),v=n(9548),S=n(5421),k=n(4225),I=n(9096),C=n(2200),P=n(2898),T=n(6319),A=n(9232),z=n(2368),E=n(2449),_=n(9637),N=n(4067),F=n(899),D=n(7665),B=n(7097),M=n(6475),K=n(988),G=n(8354);const L={info:"Tj85cyFPmCb5IuH3PLzT",item:"u_y0mHJV5dJDeaup7AnQ",warning:"mgJMlWizrI_1zV6gKDww",radioCard:"_tg59NZLBI4ufk2D9_x4",dropdown:"Dpk9BMBojJjovE83ymYi"};var q=n(790);function R(){return(0,q.jsxs)(d.Group,{gap:"xs",children:[(0,q.jsx)(d.Skeleton,{height:24,circle:!0}),(0,q.jsx)(O,{}),(0,q.jsx)(d.Skeleton,{height:48,width:300})]})}function O(){return(0,q.jsxs)(d.Stack,{gap:"8px",children:[(0,q.jsx)(d.Skeleton,{height:8,width:100,radius:"xl"}),(0,q.jsx)(d.Skeleton,{height:8,width:100,radius:"xl"})]})}const W=(0,u.gP)(),Y=e=>{const{amplifyConfigured:t,apiUrl:n,ownAccountId:s,accountId:o,siteId:a,siteKey:c,nonce:E,setAccountId:_,setSiteId:N,setSiteKey:F}=e,[M,K]=(0,r.useState)(),[G,Y]=(0,r.useState)(),{authStatus:X,toSignIn:U,signOut:$}=(0,x.A)(e=>[e.user,e.authStatus,e.route]),J=!(!o||!a||"authenticated"!==X&&!c),[H,V]=(0,r.useState)(),[Z,ee]=(0,r.useState)(),[te,ne]=(0,r.useState)(),[se,ie]=(0,r.useState)(J?void 0:null),[oe,ae]=(0,r.useState)(o||a?void 0:null),[re,ce]=(0,r.useState)(o||a?void 0:null),le=(0,d.useMediaQuery)(`(max-width: ${d.DEFAULT_THEME.breakpoints.sm})`),{width:de}=(0,d.useViewportSize)(),ue=Math.min(300,de-parseInt((0,d.rem)(32))),he=(0,d.useModalsStack)(["connect-your-site","prices"]),me=(0,D.jE)(),pe=(0,B.n)({mutationFn:({site:e,action:t})=>(Y(t),(0,m.F6)({apiName:"backend",path:"/account/"+e.accountId+"/site/"+e.siteId,options:{queryParams:{action:t}}}).response.then(e=>e.body.json()).then(e=>(d.notifications.show({title:(0,l.__)("Subscription changed",u.Xg),message:(0,l.__)("Subscription changed successfully.",u.Xg),color:"green",icon:(0,q.jsx)(j.A,{}),className:L.notification}),e)).catch(e=>{console.error("Error:",e.message),d.notifications.show({title:(0,l.__)("Error occured",u.Xg),message:e.message,color:"red",icon:(0,q.jsx)(b.A,{}),className:L.notification}),ne(null)}).finally(()=>{Y(void 0)})),onSuccess:()=>{me.invalidateQueries({queryKey:["site",o,a]})}}),xe=(0,r.useCallback)(async()=>{Z?(0,m.Jt)({apiName:"backend",path:`/account/${o}/billing-auth-session`}).response.then(e=>e.body.json()).then(e=>{ne(e.token)}).catch(e=>{console.error("Error:",e.message),ne(null)}):ne(null),he.open("prices")},[o,Z,he]),ge=(0,r.useCallback)(async e=>{if(!oe||M)return;K(null!=e?e:"manage");const t={next_url:window.location.href,subscription_id:oe.id};e&&(t.type=e),await(0,m.Jt)({apiName:"backend",path:`/account/${o}/billing-portal-session`,options:{queryParams:t}}).response.then(e=>e.body.json()).then(e=>{const t=e.url;window.location.assign(t)}).catch(e=>{console.error("Error:",e.message),K(void 0)})},[o,M,oe]),je=(0,r.useCallback)((e,t)=>{var n,s,i;let o="Confirm",a=(0,q.jsx)(q.Fragment,{});switch(t){case"cancel":o="Yes, Cancel",a=(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(g.D,{level:3,marginBottom:"var(--mantine-spacing-md)",children:"Cancel Subscription"}),(0,q.jsxs)(d.Text,{mb:"sm",children:["Your subscription will be canceled, but is still available until the end of your billing period on"," ",(0,q.jsx)("strong",{children:new Date(1e3*(null!==(n=e.subscription?.currentPeriodEnd)&&void 0!==n?n:0))?.toLocaleString("en")}),". If you change your mind, you can renew your subscription."]}),(0,q.jsx)(d.Text,{fw:500,children:"Are you sure you want to cancel your subscription?"})]});break;case"cancel_schedule":o="Yes, Cancel",a=(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(g.D,{level:3,marginBottom:"var(--mantine-spacing-md)",children:"Cancel Scheduled Change"}),(0,q.jsxs)(d.Text,{mb:"sm",children:["If canceled, your subscription will continue with the original terms after"," ",(0,q.jsx)("strong",{children:new Date(1e3*(null!==(s=e.subscription?.currentPeriodEnd)&&void 0!==s?s:0))?.toLocaleString("en")}),"."]}),(0,q.jsx)(d.Text,{fw:500,children:"Are you sure you want to cancel the scheduled change to your subscription?"})]});break;case"renew":o="Yes, Renew",a=(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(g.D,{level:3,marginBottom:"var(--mantine-spacing-md)",children:"Renew Subscription"}),(0,q.jsxs)(d.Text,{size:"sm",children:["This subscription will no longer be canceled. It will renew on"," ",new Date(1e3*(null!==(i=e.subscription?.currentPeriodEnd)&&void 0!==i?i:0))?.toLocaleString("en"),"."]})]})}d.modals.openConfirmModal({children:a,labels:{confirm:o,cancel:"No"},confirmProps:{className:L["console-button"]},cancelProps:{variant:"outline",className:L["console-button-outline"]},withCloseButton:!1,onConfirm:()=>pe.mutate({site:e,action:t}),zIndex:1e5,xOffset:"1dvh",yOffset:"1dvh",centered:!0})},[pe]),{isError:be}=(0,i.I)({queryKey:["account",o],queryFn:()=>async function(e){const t=await(0,m.Jt)({apiName:"backend",path:`/account/${e}`}).response;return await t.body.json()}(o).then(e=>(e?ee(e.customer?e?.customerId:null):"authenticated"!==X||o&&!be||ee(null),e)).catch(()=>{ae(null)}),enabled:!!o&&"authenticated"===X}),{isError:ye,isPending:fe}=(0,i.I)({queryKey:["site",o,a],queryFn:()=>async function(e,t,n){const s={apiName:"backend",path:`/account/${e}/site/${t}${n?"/settings":""}`,options:{headers:{}}};n&&(s.options.headers["X-Site-Key"]=n);const i=await(0,m.Jt)(s).response;return await i.body.json()}(o,a,c).then(e=>{var t;return ce(null!==(t=e.subscriptionType)&&void 0!==t?t:null),ae(e.subscription),ie(e),e}).catch(e=>{throw ie(null),ae(null),e}),enabled:J}),we=(0,r.useCallback)(async e=>{const t=e?e.subscriber:!!re;return fetch(W.restUrl+"/update-site-settings",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":E},body:JSON.stringify({accountId:e?e.accountId:o,siteId:e?e.siteId:a,siteKey:e?e.siteKey:c,lastUpdate:(new Date).getTime(),subscriber:t}),credentials:"same-origin"}).finally(()=>{e&&o!==e.accountId&&a!==e.siteId&&(ie(null),e.accountId||ce(null),_(e.accountId),N(e.siteId),F(e.siteKey))})},[o,E,_,N,F,a,c,re]),ve=(0,B.n)({mutationFn:e=>we(e),onSuccess:async e=>{if(e.ok)d.notifications.show({title:(0,l.__)("Settings saved",u.Xg),message:(0,l.__)("Site settings saved successfully",u.Xg),color:"green",icon:(0,q.jsx)(y.A,{}),className:L.notification});else{const t=await e.json();console.error("Failed to connect site",t),d.notifications.show({title:(0,l.__)("Error occured",u.Xg),message:t.message,color:"red",icon:(0,q.jsx)(b.A,{}),className:L.notification})}he.close("connect-your-site")},onError:e=>{d.notifications.show({title:(0,l.__)("Error occured",u.Xg),message:e.message,color:"red",icon:(0,q.jsx)(b.A,{}),className:L.notification})}}),Se=(0,r.useCallback)(()=>(0,q.jsxs)(d.Menu,{shadow:"md",width:220,children:[(0,q.jsx)(d.Menu.Target,{children:(0,q.jsx)(d.Button,{variant:"subtle",ml:"xs",leftSection:(0,q.jsx)(f.A,{size:16}),children:"Settings"})}),(0,q.jsxs)(d.Menu.Dropdown,{children:[(0,q.jsx)(d.Menu.Label,{children:"Site"}),o&&a&&(se||ye)?(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(d.Menu.Item,{leftSection:(0,q.jsx)(w.A,{size:16}),onClick:()=>he.open("connect-your-site"),children:"Reconnect"}),(0,q.jsx)(d.Menu.Item,{leftSection:(0,q.jsx)(v.A,{size:16}),onClick:()=>d.modals.openConfirmModal({children:(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(g.D,{level:3,marginBottom:"var(--mantine-spacing-md)",children:"Disconnect This Site"}),(0,q.jsx)(d.Text,{mb:"sm",children:"Disconnecting this site will immediately remove all Pro settings â€“ including API Settings and Form-Field customizations â€“ from WordPress."}),(0,q.jsx)(d.Text,{mb:"sm",children:"Any active subscription tied to this site will keep billing but won't deliver benefits until you reconnect."}),(0,q.jsx)(d.Text,{mb:"sm",children:"If you later reconnect this same site, its previous settings will be restored; linking a different site will start with default settings."}),(0,q.jsx)(d.Text,{fw:500,children:"Are you sure you want to disconnect this site from WP Suite?"})]}),labels:{confirm:"Yes, Disconnect",cancel:"No"},confirmProps:{className:L["console-button"]},cancelProps:{variant:"outline",className:L["console-button-outline"]},withCloseButton:!1,onConfirm:()=>we({}),zIndex:1e5,xOffset:"1dvh",yOffset:"1dvh",centered:!0}),children:"Disconnect"}),(0,q.jsx)(d.Menu.Item,{leftSection:(0,q.jsx)(S.A,{size:16}),onClick:async()=>{try{const e=await we();if(e.ok)d.notifications.show({title:(0,l.__)("Cache cleared",u.Xg),message:(0,l.__)("Front-end site configuration cleared successfully.",u.Xg),color:"green",icon:(0,q.jsx)(k.A,{}),className:L.notification});else{const t=await e.json();console.error("Failed to submit data",t),d.notifications.show({title:(0,l.__)("Error occured",u.Xg),message:t.message,color:"red",icon:(0,q.jsx)(b.A,{}),className:L.notification})}}catch(e){d.notifications.show({title:(0,l.__)("Error occured",u.Xg),message:e.message,color:"red",icon:(0,q.jsx)(b.A,{}),className:L.notification})}},children:"Clear Cache"}),"authenticated"===X&&(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(d.Menu.Divider,{}),(0,q.jsx)(d.Menu.Label,{children:"Subscription"}),null===re&&(0,q.jsx)(d.Menu.Item,{leftSection:(0,q.jsx)(I.A,{size:16}),onClick:()=>xe(),disabled:s!==o,children:"Plans & Pricing"}),se&&null!==re&&oe&&!be&&(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(d.Menu.Item,{leftSection:(0,q.jsx)(I.A,{size:16}),disabled:s!==o||!!M||!!G,onClick:()=>ge(),children:"Manage Billing"}),(0,q.jsx)(d.Menu.Item,{leftSection:(0,q.jsx)(C.A,{size:16}),disabled:s!==o||!!M||!!G,onClick:()=>ge("update"),children:"Update"}),(oe.cancelAtPeriodEnd||oe.nextSubscriptionType&&oe.nextSubscriptionType!==re)&&(0,q.jsx)(d.Menu.Item,{leftSection:(0,q.jsx)(P.A,{size:16}),disabled:s!==o||!!M||!!G,onClick:()=>je(se,oe.cancelAtPeriodEnd?"renew":"cancel_schedule"),children:oe.cancelAtPeriodEnd?"Renew":"Cancel Scheduled Update"}),!oe.cancelAtPeriodEnd&&(0,q.jsx)(d.Menu.Item,{leftSection:(0,q.jsx)(T.A,{size:16}),disabled:s!==o||!!M||!!G,onClick:()=>je(se,"cancel"),children:"Cancel"})]})]})]}):(0,q.jsx)(d.Menu.Item,{leftSection:(0,q.jsx)(w.A,{size:16}),onClick:()=>he.open("connect-your-site"),children:"Connect"})]})]}),[o,X,we,M,be,ye,G,ge,je,xe,s,se,a,he,oe,re]);return(0,r.useEffect)(()=>{"authenticated"===X&&(0,p.T)().then(e=>V(e?.email))},[n,X]),(0,r.useEffect)(()=>{o&&a&&(0,u.zj)("wpsuite").then(e=>e&&e.subscriptionType?ce(e.subscriptionType):ce(null))},[o,a]),(0,r.useEffect)(()=>{"authenticated"!==X&&"unauthenticated"!==X||(me.invalidateQueries({queryKey:["accounts"]}),me.invalidateQueries({queryKey:["sites",o]}),me.invalidateQueries({queryKey:["site",o,a]}))},[o,t,X,me,a]),(0,q.jsxs)(d.Group,{justify:"space-between",align:"stretch",w:"100%",wrap:"nowrap",style:{flexDirection:le?"column-reverse":"row-reverse"},children:[(0,q.jsxs)(d.Modal.Stack,{children:[(0,q.jsx)(d.Modal,{...he.register("connect-your-site"),withCloseButton:!0,size:400,centered:!0,zIndex:1e5,title:(0,q.jsx)(d.Text,{size:"lg",fw:700,children:"Connect Your Site"}),children:(0,q.jsx)(h.k,{loginMechanisms:["email"],signUpAttributes:["email","family_name","given_name"],formFields:{signUp:{"custom:acknowledgement":{isRequired:!0,label:'By creating an account, you agree to our <a href="https://wpsuite.io/privacy-policy" target="_blank" rel="noopener noreferrer" class="dark-link">Privacy Policy</a> and <a href="https://wpsuite.io/terms-of-use" target="_blank" rel="noopener noreferrer" class="dark-link">Terms of Use</a>, including the binding arbitration clause and class action waiver in Section 9.2.',type:"checkbox"}}},children:(0,q.jsx)(Q,{authStatus:X,accountId:null!=s?s:o,siteId:a,siteKey:c,subscriber:!!re,onClose:()=>he.close("connect-your-site"),onConnect:e=>new Promise(t=>{ve.mutate(e,{onSettled:()=>t()})})})})}),(0,q.jsx)(d.Modal,{...he.register("prices"),withCloseButton:!0,size:"xl",zIndex:1e5,centered:!0,title:(0,q.jsx)(d.Text,{size:"lg",fw:700,children:"Plans and Pricing"}),onClose:()=>{ne(void 0),he.close("prices")},children:void 0!==te&&void 0!==H&&o&&a&&(0,q.jsx)(d.Group,{justify:"center",mt:20,children:(0,q.jsxs)(d.Stack,{w:"100%",gap:20,children:[(0,q.jsx)(d.Text,{children:"Choose the plan that fits your WordPress site!"}),(0,q.jsxs)(d.Text,{size:"sm",children:["Start free with WP Suite core features. Upgrade to Pro to unlock advanced customization, integrations, and premium support across all WP Suite plugins."," ",(0,q.jsx)("a",{className:"dark-link",href:"/pricing/",children:"Pricing"})," ","page."]}),te?(0,q.jsx)("stripe-pricing-table",{"pricing-table-id":e.pricingTable,"publishable-key":e.stripePublicKey,"client-reference-id":o+"-"+a,"customer-session-client-secret":te}):(0,q.jsx)("stripe-pricing-table",{"pricing-table-id":e.pricingTable,"publishable-key":e.stripePublicKey,"client-reference-id":o+"-"+a,"customer-email":H}),(0,q.jsx)(d.Group,{align:"center",className:L.info,children:(0,q.jsxs)(d.Flex,{align:"start",direction:"column",className:L.text,gap:{base:10,sm:0},children:[(0,q.jsx)(d.Title,{order:5,children:"Additional Information"}),(0,q.jsx)(d.List,{spacing:"xs",size:"xs",children:(0,q.jsx)(d.List.Item,{className:L.item,children:"All prices are net amounts. Applicable taxes (e.g., VAT, Sales Tax) may be added depending on your location and circumstances."})})]})})]})})})]}),"configuring"===X&&(0,q.jsx)(R,{}),"unauthenticated"===X&&(0,q.jsxs)(d.Card,{p:"sm",withBorder:!0,w:{base:"100%",sm:"40%"},maw:{base:"100%",sm:300},children:[(0,q.jsx)(d.Group,{style:{borderBottom:"1px solid #e0e0e0"},mb:"md",children:(0,q.jsx)(d.Text,{fw:500,children:"Account Information"})}),(0,q.jsxs)(d.Group,{gap:"xs",style:{justifyContent:"space-between"},children:[(0,q.jsxs)(d.Group,{gap:"xs",children:[(0,q.jsx)(A.A,{size:16}),(0,q.jsx)(d.Text,{size:"sm",children:"You are not signed in."})]}),(0,q.jsxs)(d.Button,{variant:o&&a?"outline":"gradient",leftSection:(0,q.jsx)(z.A,{size:16}),onClick:()=>{U(),he.open("connect-your-site")},disabled:!t,children:["Sign In ",o&&a?"to Reconnect":"and Connect"," ","Your Site"]}),!t&&(0,q.jsxs)(d.HoverCard,{children:[(0,q.jsx)(d.HoverCard.Target,{children:(0,q.jsx)(d.ActionIcon,{variant:"subtle",size:"xs",children:(0,q.jsx)(b.A,{size:16,color:"red"})})}),(0,q.jsx)(d.HoverCard.Dropdown,{maw:300,style:{zIndex:1e5},children:(0,q.jsxs)(d.Text,{size:"sm",children:["ðŸ›‘ ",(0,q.jsx)("strong",{children:"Heads-up"}),": Configuration is temporarily unavailable. Please try again later â€” no action is needed on your side."]})})]})]})]}),"authenticated"===X&&(0,q.jsxs)(d.Card,{p:"sm",withBorder:!0,w:{base:"100%",sm:"40%"},maw:{base:"100%",sm:300},children:[(0,q.jsx)(d.Group,{style:{borderBottom:"1px solid #e0e0e0"},mb:"md",children:(0,q.jsx)(d.Text,{fw:500,children:"Account Information"})}),null!=re&&!oe&&(be&&(0,q.jsx)(d.Alert,{color:"red",title:"Notice â€“ Limited functionality due to network error",icon:(0,q.jsx)(b.A,{}),w:"100%",children:(0,q.jsx)(d.Text,{size:"sm",mb:"xs",children:"Youâ€™re logged in to WordPress as an admin, but configuration and PRO features are currently unavailable. Please try again later â€” no action is needed on your side."})})||(!fe&&!a||ye)&&(0,q.jsx)(d.Alert,{color:"red",title:"Access denied â€“ You donâ€™t have access to this siteâ€™s PRO configuration",icon:(0,q.jsx)(b.A,{}),w:"100%",children:(0,q.jsx)(d.Text,{size:"sm",mb:"xs",children:"Youâ€™re logged in to WordPress as an admin, but the Gatey account you used isnâ€™t on the allowed members list for this connected site."})})),(0,q.jsxs)(d.Group,{gap:"xs",style:{justifyContent:"space-between"},children:[!H&&(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(d.Skeleton,{height:24,circle:!0}),(0,q.jsx)(O,{})]}),H&&(0,q.jsxs)(d.Flex,{gap:"xs",p:"sm",align:"center",children:[(0,q.jsx)(A.A,{size:16}),(0,q.jsx)(d.Text,{size:"sm",children:H})]}),(0,q.jsx)(d.Button,{variant:"outline",onClick:()=>{$(),ee(null)},leftSection:(0,q.jsx)(v.A,{size:16}),children:"Sign Out"})]})]}),(0,q.jsxs)(d.Card,{p:"sm",withBorder:!0,w:{base:"100%",sm:"auto"},style:{flexGrow:1},children:[(0,q.jsx)(d.Group,{style:{borderBottom:"1px solid #e0e0e0"},mb:"md",children:(0,q.jsx)(d.Text,{fw:500,children:"Site Details"})}),(0,q.jsxs)(d.Grid,{align:"center",style:{justifyContent:"space-between"},children:[(0,q.jsxs)(d.Grid.Col,{span:{base:12,sm:2},children:["Status"," ",le&&(0,q.jsx)(d.Skeleton,{display:"inline-grid",w:"fit-content",visible:void 0===se&&fe,children:o&&a&&!ye?(0,q.jsx)(d.Badge,{color:"green",miw:100,children:"Connected"}):(0,q.jsx)(d.Badge,{color:"grey",miw:120,children:o&&a?"Connected (unreachable)":"Not connected"})})]}),(0,q.jsx)(d.Grid.Col,{span:{base:12,sm:10},children:(0,q.jsxs)(d.Flex,{direction:{base:"column",sm:"row"},gap:"sm",align:"center",children:[!le&&(0,q.jsx)(d.Skeleton,{display:"inline-grid",w:"fit-content",visible:void 0===se&&fe,children:o&&a&&!ye?(0,q.jsx)(d.Badge,{color:"green",miw:100,children:"Connected"}):(0,q.jsx)(d.Badge,{color:"grey",miw:120,children:o&&a?"Connected (unreachable)":"Not connected"})}),se&&(0,q.jsx)(d.Skeleton,{w:"100%",visible:void 0===se&&fe,children:(0,q.jsx)(d.Flex,{bg:"gray.0",align:"center",p:"sm",style:{borderRadius:6},children:se&&(0,q.jsx)(q.Fragment,{children:(0,q.jsxs)(d.Stack,{gap:2,style:{flexGrow:1},children:[(0,q.jsxs)(d.Text,{size:"sm",fw:500,component:"div",children:["Site: ",se.name," (id: ",se.siteId,")",null!=re&&(0,q.jsxs)(d.HoverCard,{shadow:"md",width:le?ue:300,position:"bottom-start",offset:8,withArrow:!0,styles:le?{dropdown:{left:"20px"}}:{},children:[(0,q.jsx)(d.HoverCard.Target,{children:(0,q.jsx)(d.ActionIcon,{variant:"subtle",size:"xs",className:L["info-icon"],children:(0,q.jsx)(y.A,{size:16})})}),(0,q.jsxs)(d.HoverCard.Dropdown,{style:{maxWidth:"calc(100vw - 2rem)"},children:[(0,q.jsx)(g.D,{level:4,marginBottom:"xs",children:"License Refresh"}),(0,q.jsxs)(d.Text,{size:"sm",mb:"sm",children:["Send a"," ",(0,q.jsx)(d.Text,{component:"span",fw:700,children:"GET"})," ","request to the URL below, including theÂ ",(0,q.jsx)(d.Code,{mx:"xs",children:"X-Site-Key"})," header."]}),(0,q.jsxs)(d.Text,{size:"sm",mb:"sm",children:["The server returns a JSON object; the value of its ",(0,q.jsx)(d.Code,{children:"jws"})," property is the license content."]}),(0,q.jsxs)(d.Text,{size:"sm",mb:"sm",children:["Save that value as ",(0,q.jsx)(d.Code,{children:"lic.jws"})," in your siteâ€™sÂ ",(0,q.jsx)(d.Code,{children:"/wp-content/uploads/hub-for-wpsuiteio/"})," ","directory."]}),(0,q.jsxs)(d.Text,{size:"sm",mb:"sm",children:[(0,q.jsx)(d.Text,{fw:600,component:"span",children:"Note:"})," ","the license file is valid for"," ",(0,q.jsx)("b",{children:"oneÂ month"}),". On"," ",(0,q.jsx)("b",{children:"staticÂ sites"}),", automate a refresh at least ",(0,q.jsx)("b",{children:"once a week"}),". On"," ",(0,q.jsx)("b",{children:"WordPress"})," sites, the Gatey plugin refreshes it automaticallyâ€”no manual action needed."]})," ",(0,q.jsxs)(d.Text,{size:"sm",children:[(0,q.jsx)(d.Text,{fw:600,component:"span",children:"URL:"})," ",(0,q.jsx)(d.Code,{children:(0,q.jsx)("strong",{children:(0,q.jsx)("a",{href:"#",target:"_blank",rel:"noopener noreferrer",className:"dark-link",style:{textDecoration:"none"},onClick:e=>(e.preventDefault(),e.stopPropagation(),jQuery("#gatey-license-url-"+se.siteId).trigger("select"),navigator.clipboard.writeText(n+"/account/"+se.accountId+"/site/"+se.siteId+"/license"),d.notifications.show({title:"License URL copied",message:"License URL copied successfully.",color:"green",icon:(0,q.jsx)(y.A,{}),className:L.notification}),!1),children:(0,q.jsx)("span",{id:"gatey-license-url-"+se.siteId,children:"copy"})})})}),(0,q.jsx)("br",{}),(0,q.jsx)(d.Text,{fw:600,component:"span",children:"X-Site-Key:"})," ",(0,q.jsx)(d.Code,{children:(0,q.jsx)("strong",{children:(0,q.jsx)("a",{href:"#",target:"_blank",rel:"noopener noreferrer",className:"dark-link",style:{textDecoration:"none"},onClick:e=>{var t;return e.preventDefault(),e.stopPropagation(),jQuery("#gatey-site-key-"+se.siteId).trigger("select"),navigator.clipboard.writeText(null!==(t=se.siteKey)&&void 0!==t?t:""),d.notifications.show({title:"Site key copied",message:"Site key copied successfully.",color:"green",icon:(0,q.jsx)(y.A,{}),className:L.notification}),!1},children:(0,q.jsx)("span",{id:"gatey-site-key-"+se.siteId,children:"copy"})})})})]})]})]})]}),se.account&&(0,q.jsx)(q.Fragment,{children:(0,q.jsxs)(d.Text,{size:"xs",c:"dimmed",component:"div",children:["Workspace: ",se.account.name," (id:"," ",se.account.accountId,", owner:"," ",(0,q.jsx)("a",{className:"dark-link",href:`mailto:${se.account.ownerEmail}`,target:"_blank",rel:"noopener noreferrer",children:se.account.ownerEmail}),")"]})})]})})})})]})}),(0,q.jsxs)(d.Grid.Col,{span:{base:12,sm:2},children:["Subscription"," ",le&&(0,q.jsxs)(q.Fragment,{children:[(0,q.jsxs)(d.Skeleton,{display:"inline-grid",w:"fit-content",visible:void 0===re,children:[null===re&&(0,q.jsx)(d.Badge,{color:"grey",miw:45,children:"FREE"}),"PROFESSIONAL"===re&&(0,q.jsx)(d.Badge,{color:"red",miw:35,children:"PRO"})]}),Se()]})]}),(0,q.jsx)(d.Grid.Col,{span:{base:12,sm:10},children:(0,q.jsxs)(d.Flex,{direction:{base:"column",sm:"row"},gap:"sm",align:"center",children:[" ",!le&&(0,q.jsxs)(d.Skeleton,{display:"inline-grid",w:"fit-content",visible:void 0===re,children:[null===re&&(0,q.jsx)(d.Badge,{color:"grey",miw:45,children:"FREE"}),"PROFESSIONAL"===re&&(0,q.jsx)(d.Badge,{color:"red",miw:35,children:"PRO"})]}),!!re&&(0,q.jsx)(d.Group,{gap:"xs",style:{justifyContent:"space-between"},children:(0,q.jsx)(d.Skeleton,{w:"100%",visible:void 0===re||null!==re&&!oe&&fe,children:(0,q.jsx)(d.Flex,{bg:"gray.0",p:"sm",align:"center",style:{borderRadius:6,flexGrow:1},children:null!==re&&(0,q.jsx)(d.Stack,{gap:2,children:(0,q.jsxs)(d.Text,{size:"sm",fw:500,component:"div",children:[oe?oe?.active?"Subscription active":"Subscription inactive":"Subscription inaccessible",oe&&oe.active&&oe.cancelAtPeriodEnd&&(0,q.jsxs)(q.Fragment,{children:[" ","â€” expires on"," ",(0,q.jsx)("strong",{children:new Date(1e3*oe.currentPeriodEnd).toLocaleDateString()})]}),oe&&oe.active&&!oe.cancelAtPeriodEnd&&(0,q.jsxs)(q.Fragment,{children:[" ","â€” renews automatically"," ",oe.nextSubscriptionType&&re!==oe.nextSubscriptionType&&(0,q.jsxs)(q.Fragment,{children:["as a"," ",(0,q.jsx)("strong",{children:oe.nextSubscriptionType})," ","subscription"," "]}),"on"," ",(0,q.jsx)("strong",{children:new Date(1e3*oe.currentPeriodEnd).toLocaleDateString()})]})]})})})})}),!le&&Se()]})})]})]})]})};function X(){return(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(d.Skeleton,{w:{base:"100%",xs:350},height:80,mb:"md"}),(0,q.jsx)(d.Skeleton,{w:{base:"100%",xs:350},height:80,mb:"md"}),(0,q.jsx)(d.Skeleton,{w:{base:"100%",xs:350},height:80,mb:"md"})]})}const U=G.Ikc({siteId:G.YjP().optional(),name:G.YjP(),domain:G.YjP(),subscriptionType:G.YjP().optional()});function Q({authStatus:e,accountId:t,siteId:n,siteKey:s,subscriber:o,onClose:a,onConnect:c}){const[h,p]=(0,r.useState)(!1),[x,j]=(0,r.useState)(!1),[f,S]=(0,r.useState)(1),[I,C]=(0,r.useState)(!1),[P,T]=(0,r.useState)(t),[A,z]=(0,r.useState)(n),[G,R]=(0,r.useState)(s),[O,W]=(0,r.useState)(o),[Y,Q]=(0,r.useState)(""),[$,J]=(0,r.useState)("name"),[H]=(0,d.useDebouncedValue)(Y,200),V=(0,d.useForm)({mode:"uncontrolled",initialValues:{subscriptionType:"",siteId:"",name:"",domain:""},validate:(0,K.s)(U)}),Z=(0,r.useCallback)(()=>(0,m.Jt)({apiName:"backendWithIam",path:"/account"}).response.then(e=>e.body.json()).then(e=>{const t=e;return P||T(t[0].accountId),t}).catch(e=>{throw console.error("Error fetching workspaces:",e),e}).finally(()=>{p(!1)}),[P]),ee=(0,r.useCallback)(({pageParam:e=null})=>(0,m.Jt)({apiName:"backend",path:`/account/${P}/site`,options:e?{queryParams:{limit:String(3),last_key:e,order:$,...H?{search:H}:{}}}:{queryParams:{limit:String(3),order:$,...H?{search:H}:{}}}}).response.then(e=>e.body.json()).then(e=>e).catch(e=>{throw console.error("Error fetching sites:",e),e}).finally(()=>{p(!1)}),[P,H,$]),{data:te,isPending:ne,error:se}=(0,i.I)({queryKey:["accounts"],queryFn:Z,enabled:"authenticated"===e}),{data:ie,isPending:oe,error:ae,fetchNextPage:re,hasNextPage:ce,isFetchingNextPage:le}=(0,M.q)({queryKey:["sites",P,H,$],queryFn:ee,initialPageParam:null,getNextPageParam:e=>{var t;return null!==(t=e.lastKey)&&void 0!==t?t:void 0},select:e=>({pages:e.pages.filter(e=>e.list.length>0)}),enabled:!!P&&"authenticated"===e}),de=(0,r.useMemo)(()=>{var e;return null!==(e=ie?.pages.flatMap(e=>e.list))&&void 0!==e?e:[]},[ie]),ue=(0,r.useMemo)(()=>{var e;return Math.max(null!==(e=ie?.pages.length)&&void 0!==e?e:0,1)},[ie]);ue>0&&f>ue&&S(ue);const he=(0,r.useCallback)(e=>{e>ue&&ce?re().then(t=>{var n;S(Math.min(e,null!==(n=t?.data?.pages.length)&&void 0!==n?n:0))}):S(e)},[re,ce,ue]),me=(0,D.jE)(),pe=(0,B.n)({mutationFn:async e=>{const t={name:e.name,domain:e.domain};return await(e.siteId&&""!==e.siteId.trim()?m.yJ({apiName:"backend",path:`/account/${P}/site/${e.siteId}`,options:{body:t}}):m.bE({apiName:"backend",path:`/account/${P}/site`,options:{body:t}})).response.then(e=>e.body.json()).then(e=>(d.notifications.show({title:(0,l.__)("Site updated",u.Xg),message:(0,l.__)("Site updated successfully.",u.Xg),color:"green",icon:(0,q.jsx)(y.A,{}),className:L.notification}),e)).catch(e=>{console.error("Error:",e.message),d.notifications.show({title:(0,l.__)("Error occured",u.Xg),message:e.message,color:"red",icon:(0,q.jsx)(b.A,{}),className:L.notification})})},onSuccess:()=>{me.invalidateQueries({queryKey:["sites",P]}),C(!1)},onError:e=>{d.notifications.show({title:(0,l.__)("Error occured",u.Xg),message:e.message,color:"red",icon:(0,q.jsx)(b.A,{}),className:L.notification})}}),xe=(0,B.n)({mutationFn:async e=>{await m.yH({apiName:"backend",path:`/account/${P}/site/${e}`}).response},onMutate:async e=>{await me.cancelQueries({queryKey:["sites"]});const t=me.getQueryData(["sites"]);return me.setQueryData(["sites"],t=>t?{...t,pages:t.pages.map(t=>({...t,list:t.list.filter(t=>t.siteId!==e)}))}:t),{prev:t}},onSuccess:()=>{me.invalidateQueries({queryKey:["sites",P]}),A===n&&(T(void 0),z(void 0),R(void 0),W(void 0))}}),ge=(0,r.useMemo)(()=>{const e=3*(f-1);return de?.slice(e,e+3)},[de,f]);return ne?(0,q.jsx)(X,{}):(0,q.jsxs)(q.Fragment,{children:[se?(0,q.jsxs)(d.Text,{c:"red",children:["Error: ",se?.message]}):(0,q.jsxs)(q.Fragment,{children:[(te?.length>1||!te.find(e=>e.accountId===P))&&(0,q.jsx)(d.Select,{label:"Select a workspace",description:"Select a workspace to manage sites",w:{base:"100%",xs:350},height:80,mb:"md",value:P,onChange:e=>{e&&(T(e),z(e===t?n:void 0),R(e===t?s:void 0),W(e===t?o:void 0),S(1),C(!1))},data:te.map(e=>({value:e.accountId,label:e.name})),classNames:{dropdown:L.dropdown}}),(0,q.jsxs)(d.Radio.Group,{label:"Select a site",description:"Select a site to connect this WordPress instance to",mb:"md",defaultValue:n+"|"+s+"|"+o,value:A+"|"+G+"|"+O,onChange:e=>{const t=e.split("|");z(t[0]),t.length>1&&R(t[1]),t.length>2&&W("true"===t[2])},children:[(0,q.jsxs)(d.Group,{gap:"xs",mt:"xs",children:[(0,q.jsx)(d.SegmentedControl,{size:"xs",data:[{label:"Name",value:"name"},{label:"Domain",value:"domain"}],value:$,onChange:e=>J(e)}),(0,q.jsx)(d.TextInput,{placeholder:"Filterâ€¦",size:"xs",value:Y,onChange:e=>{Q(e.currentTarget.value),S(1)}})]}),(0,q.jsx)(d.Skeleton,{visible:le||!!P&&"authenticated"===e&&(oe||h),mt:"md",mb:"md",children:(0,q.jsxs)(d.Stack,{pt:"md",mb:"md",gap:"xs",children:[(0,q.jsxs)(d.Group,{gap:"xs",style:{alignContent:"flex-start",overflowY:"auto"},children:[(!ge?.length||0===ge.length)&&!I&&(0,q.jsxs)(d.Stack,{align:"center",gap:"md",py:"xl",mb:"lg",w:{base:"100%",xs:350},children:[(0,q.jsx)(d.Title,{order:4,children:"No Sites Found"}),(0,q.jsx)(d.Text,{c:"dimmed",size:"sm",ta:"center",children:"You haven't added any sites yet."}),(0,q.jsx)(d.Button,{variant:"gradient",size:"xs",leftSection:(0,q.jsx)(E.A,{size:16}),onClick:()=>{V.setValues({subscriptionType:"",siteId:"",name:"",domain:""}),C(!0)},children:"Add a new site"})]}),!I&&ge?.map(e=>(0,q.jsx)(d.Radio.Card,{className:L.radioCard,component:"div",p:"md",radius:"md",value:e.siteId+"|"+e.siteKey+"|"+(void 0!==e.subscription),disabled:I,children:(0,q.jsxs)(d.Group,{wrap:"nowrap",align:"flex-start",children:[(0,q.jsx)(d.Radio.Indicator,{}),(0,q.jsxs)(d.Stack,{gap:"xs",style:{flexGrow:1},children:[(0,q.jsxs)(d.Text,{component:"div",fw:700,lh:1.3,size:"md",c:"bright",children:[e.name,e.domain===location.hostname.split(":")[0]&&(0,q.jsx)(d.Badge,{size:"xs",ml:"xs",variant:"light",children:"Current domain"})]}),(0,q.jsxs)(d.Text,{c:"dimmed",size:"xs",children:[e.domain," "]})]}),(0,q.jsx)(d.Tooltip,{label:"Edit site",children:(0,q.jsx)(d.ActionIcon,{variant:"subtle",size:"xs","aria-label":"Edit site",onClick:t=>{t.stopPropagation(),V.setValues({subscriptionType:e.subscriptionType,siteId:e.siteId,name:e.name,domain:e.domain}),C(!0)},children:(0,q.jsx)(_.A,{size:16})})}),(0,q.jsx)(d.Tooltip,{label:void 0!==e.subscriptionType?"Cannot delete site with active subscription":"Delete site",children:(0,q.jsx)(d.ActionIcon,{variant:"subtle",size:"xs",color:"red","aria-label":void 0!==e.subscriptionType?"Cannot delete site with active subscription":"Delete site",disabled:void 0!==e.subscriptionType,onClick:t=>{t.stopPropagation(),d.modals.openConfirmModal({children:(0,q.jsxs)(q.Fragment,{children:[(0,q.jsxs)(g.D,{level:3,marginBottom:"var(--mantine-spacing-md)",children:["Delete ",e.name,"?"]})," ",(0,q.jsx)(d.Text,{mb:"sm",children:"This site does not have an active subscription, but it may still contain saved configuration settings from another WordPress instance."}),(0,q.jsx)(d.Text,{mb:"sm",children:"Deleting this site will permanently remove all saved settings, and this action cannot be undone."}),(0,q.jsx)(d.Text,{fw:500,children:"Are you sure you want to delete this site?"})]}),labels:{confirm:"Yes, Delete",cancel:"No"},confirmProps:{className:L["console-button"]},cancelProps:{variant:"outline",className:L["console-button-outline"]},withCloseButton:!1,onConfirm:()=>xe.mutate(e.siteId),zIndex:100002,xOffset:"1dvh",yOffset:"1dvh",centered:!0})},children:(0,q.jsx)(k.A,{size:16})})})]})},e.siteId))]}),!I&&(0,q.jsx)(d.Pagination,{classNames:{root:L.pagination,control:L["pagination-control"]},total:ce?Math.max(ue,f+1):ue,value:f,onChange:he,mt:"md"}),I&&(0,q.jsxs)(d.Card,{component:"form",withBorder:!0,w:{base:"100%",xs:350},onSubmit:V.onSubmit(e=>{pe.mutate({siteId:e.siteId,name:e.name,domain:e.domain})}),children:[(0,q.jsx)(d.LoadingOverlay,{visible:pe.isPending,zIndex:1e3,overlayProps:{radius:"md",blur:2}}),(0,q.jsx)(d.VisuallyHidden,{children:(0,q.jsx)(d.TextInput,{...V.getInputProps("siteId")},V.key("siteId"))}),(0,q.jsx)(d.TextInput,{label:"Site name",placeholder:"My WordPress site",required:!0,...V.getInputProps("name")},V.key("name")),(0,q.jsx)(d.TextInput,{label:"Licensed Domain",placeholder:"my-wordpress-site.com",required:!0,...V.getInputProps("domain")},V.key("domain")),(0,q.jsxs)(d.Group,{justify:"space-between",mt:"md",children:[(0,q.jsx)(d.Button,{variant:"outline",size:"xs",leftSection:(0,q.jsx)(N.A,{size:16}),onClick:()=>C(!1),children:"Cancel"}),(0,q.jsx)(d.Flex,{gap:0,children:(0,q.jsx)(d.Button,{type:"submit",variant:"gradient",size:"xs",leftSection:(0,q.jsx)(F.A,{size:16}),children:"Save"})})]})]}),ge&&(0,q.jsx)(d.Group,{justify:"center",children:(0,q.jsx)(d.Button,{variant:"subtle",size:"xs",leftSection:(0,q.jsx)(E.A,{size:16}),onClick:()=>{V.setValues({subscriptionType:"",siteId:"",name:"",domain:""}),C(!0)},disabled:I,children:"Add a new site"})})]})})]})]}),(0,q.jsxs)(d.Group,{justify:"space-between",children:[(0,q.jsx)(d.Button,{variant:"outline",onClick:a,leftSection:(0,q.jsx)(v.A,{size:16}),children:"Close"}),(0,q.jsx)(d.Button,{variant:"gradient",onClick:()=>{j(!0),c({accountId:P,siteId:A,siteKey:G,subscriber:O}).then(()=>{j(!1)})},leftSection:(0,q.jsx)(w.A,{size:16}),disabled:!!ae||I,loading:x,children:"Connect"})]})]})}const $=e=>((0,r.useEffect)(()=>{const e=document.createElement("script");e.src="https://js.stripe.com/v3/pricing-table.js",e.async=!0,document.head.appendChild(e)},[]),(0,q.jsx)(d.Skeleton,{visible:void 0===e.amplifyConfigured,width:"100%",mt:"md",children:void 0===e.amplifyConfigured?(0,q.jsx)(d.Group,{justify:"space-between",align:"stretch",w:"100%",h:"150px"}):(0,q.jsx)(h.k.Provider,{children:(0,q.jsx)(Y,{...e})})}));n(428);const J="dev.wpsuite.io"===window.location.host?"https://api.wpsuite.io/dev":"https://api.wpsuite.io",H="dev.wpsuite.io"===window.location.host?"https://wpsuite.io/static/config/dev.json":"https://wpsuite.io/static/config/prod.json",V=(0,u.gP)(),Z=e=>{const{nonce:t}=e,[n,h]=(0,r.useState)(),[m,p]=(0,r.useState)(),[x,g]=(0,r.useState)(V.siteSettings.accountId),[j,b]=(0,r.useState)(V.siteSettings.siteId),[y,f]=(0,r.useState)(V.siteSettings.siteKey),w=(0,d.useMediaQuery)(`(max-width: ${d.DEFAULT_THEME.breakpoints.sm})`),{data:v}=(0,i.I)({queryKey:["config"],queryFn:async()=>{const e=await fetch(H).catch(e=>({ok:!0,statusText:e.message,json:async()=>({config:"prod",baseUrl:"https://wpsuite.io",userPoolId:"us-east-1_G0wEwK9tt",identityPoolId:"us-east-1:11e55c9a-b768-48a2-8a0c-c51f1e99c129",appClientPlugin:"5e6fs3pk1k1ju7cgpnp7o7si8u",awsRegion:"us-east-1",pricingTable:"prctbl_1QA6TQFjw5MDUzy6c3fBSPGL",stripePublicKey:"pk_live_51OVeJwFjw5MDUzy6pwTbsMjcBZjZioihzLAtxQsF91u4lYJC4mtqrJddSskhz6OPbWS0tr8XL2G1AwJaXEpv9Rgn008dAz5TEr",permissions:{owner:["transfer-account","manage-account","manage-sites","manage-subscriptions","manage-billing"],admin:["manage-account","manage-sites","manage-subscriptions","manage-billing"],accountant:["manage-billing"]}})}));if(!e.ok)throw console.error("Error loading configuration:",await e.json()),h(!1),new Error(e.statusText);const t=await e.json(),n={Auth:{Cognito:{userPoolId:t.userPoolId,userPoolClientId:t.appClientPlugin,identityPoolId:t.identityPoolId}},API:{REST:{backend:{endpoint:J},backendWithIam:{endpoint:J}}}},i={API:{REST:{headers:async e=>{if("backend"===e.apiName)try{const e=await(0,s.$)();if(e?.tokens?.accessToken)return{Authorization:`Bearer ${e.tokens.accessToken}`}}catch(e){console.error(e)}return{}}}}};return o.E.configure(n,i),await S(),h(!0),t}}),S=(0,r.useCallback)(async()=>{try{var e;const t=await(0,s.$)(),n=null!==(e=t.tokens?.accessToken.payload.scope?.split(" "))&&void 0!==e?e:[];if(p(void 0),x&&!n.includes("sc.account.owner."+x)&&!n.includes("sc.account.admin."+x)){console.error("You do not have permission to access this resource. Please contact site owner.");const e=n.find(e=>e.startsWith("sc.account.owner.")||e.startsWith("sc.account.admin."))?.split(".")[3];e&&p(e)}}catch(e){console.error(e),p(void 0)}},[x]);return(0,r.useEffect)(()=>{const e=a.YZ.listen("auth",e=>{const{payload:t}=e;"signedIn"!==t.event&&"signedOut"!==t.event||S()});return()=>{e()}},[S]),(0,q.jsxs)("div",{className:"j7QpPcqW2jckSg1DEubK",children:[(0,q.jsxs)(d.Stack,{mb:"md",gap:4,children:[(0,q.jsx)(c.__experimentalHeading,{level:1,style:{display:"flex",alignItems:"center",gap:"8px",color:"#218BE6"},children:(0,l.__)(w?"WPSuite.io HUB":"Central Hub for WPSuite.io Plugins",u.Xg)}),(0,q.jsx)(d.Text,{children:"Link this WordPress installation to your WP Suite workspace to enable licensing and shared features. You can disconnect or switch workspaces at any time without affecting your content."})]})," ",(0,q.jsx)($,{apiUrl:J,amplifyConfigured:n,nonce:t,stripePublicKey:v?.stripePublicKey,pricingTable:v?.pricingTable,accountId:x,ownAccountId:null!=m?m:x,siteId:j,siteKey:y,setAccountId:g,setSiteId:b,setSiteKey:f})]})}}}]);