"use strict";(globalThis.webpackChunk_smart_cloud_wpsuite_admin=globalThis.webpackChunk_smart_cloud_wpsuite_admin||[]).push([[618],{5618:(e,s,n)=>{n.d(s,{default:()=>Pe});var i=n(548),t=n(3752),a=n(7286),o=n(9538),r=n(6886),c=n(1609),l=n(6427),d=n(7723),u=n(5304),h=n(9019),m=n(7826),p=n(6945),x=n(3661),g=(n(1880),n(4759)),j=n(4999),b=n(6252),y=n(577),w=n(8149),f=n(6193),v=n(8693),E=n(5055),S=n(1365),I=n(54),k=n(9652),C=n(4956),P=n(1179),A=n(2287),T=n(8324),_=n(132),N=n(9674),z=n(3976),D=n(3073),F=n(6713),W=n(460),Y=n(6995),M=n(7193),O=n(4039),$=n(905),B=n(5362),K=n(4577),q=n(9329),R=n(8649),L=n(4193),X=n(8335),U=n(9543),Q=n(6705),J=n(7641),H=n(7693),G=n(3737),V=n(8365),Z=n(7167),ee=n(5421),se=n(4225),ne=n(9096),ie=n(2200),te=n(2898),ae=n(6319),oe=n(9232),re=n(2368),ce=n(2449),le=n(9637),de=n(4067),ue=n(899),he=n(7665),me=n(7097),pe=n(6475),xe=n(988),ge=n(8354);const je={info:"Tj85cyFPmCb5IuH3PLzT",item:"u_y0mHJV5dJDeaup7AnQ",warning:"mgJMlWizrI_1zV6gKDww",radioCard:"_tg59NZLBI4ufk2D9_x4",dropdown:"Dpk9BMBojJjovE83ymYi"};var be=n(790);function ye(){return(0,be.jsxs)(j.Y,{gap:"xs",children:[(0,be.jsx)(g.E,{height:24,circle:!0}),(0,be.jsx)(we,{}),(0,be.jsx)(g.E,{height:48,width:300})]})}function we(){return(0,be.jsxs)(h.B,{gap:"8px",children:[(0,be.jsx)(g.E,{height:8,width:100,radius:"xl"}),(0,be.jsx)(g.E,{height:8,width:100,radius:"xl"})]})}const fe=e=>{const{amplifyConfigured:s,apiUrl:n,ownAccountId:i,accountId:o,siteId:r,siteKey:l,nonce:F,setAccountId:W,setSiteId:Y,setSiteKey:M}=e,[O,$]=(0,c.useState)(),[B,K]=(0,c.useState)(),{authStatus:q,toSignIn:L,signOut:ce}=(0,t.useAuthenticator)(e=>[e.user,e.authStatus,e.route]),le=!(!o||!r||"authenticated"!==q&&!l),[de,ue]=(0,c.useState)(),[pe,xe]=(0,c.useState)(),[ge,fe]=(0,c.useState)(),[ve,Ee]=(0,c.useState)(le?void 0:null),[Ie,ke]=(0,c.useState)(o||r?void 0:null),[Ce,Pe]=(0,c.useState)(o||r?void 0:null),Ae=(0,p.U)(`(max-width: ${u.S.breakpoints.sm})`),{width:Te}=(0,R.l)(),_e=Math.min(300,Te-parseInt((0,w.D)(32))),Ne=(0,f.e)(["connect-your-site","prices"]),ze=(0,he.jE)(),De=(0,me.n)({mutationFn:({site:e,action:s})=>(K(s),(0,b.F6)({apiName:"backend",path:"/account/"+e.accountId+"/site/"+e.siteId,options:{queryParams:{action:s}}}).response.then(e=>e.body.json()).then(e=>(U.$e.show({title:(0,d.__)("Subscription changed",x.TEXT_DOMAIN),message:(0,d.__)("Subscription changed successfully.",x.TEXT_DOMAIN),color:"green",icon:(0,be.jsx)(Q.A,{}),className:je.notification}),e)).catch(e=>{console.error("Error:",e.message),U.$e.show({title:(0,d.__)("Error occured",x.TEXT_DOMAIN),message:e.message,color:"red",icon:(0,be.jsx)(J.A,{}),className:je.notification}),fe(null)}).finally(()=>{K(void 0)})),onSuccess:()=>{ze.invalidateQueries({queryKey:["site",o,r]})}}),Fe=(0,c.useCallback)(async()=>{pe?(0,b.Jt)({apiName:"backend",path:`/account/${o}/billing-auth-session`}).response.then(e=>e.body.json()).then(e=>{fe(e.token)}).catch(e=>{console.error("Error:",e.message),fe(null)}):fe(null),Ne.open("prices")},[o,pe,Ne]),We=(0,c.useCallback)(async e=>{if(!Ie||O)return;$(null!=e?e:"manage");const s={next_url:window.location.href,subscription_id:Ie.id};e&&(s.type=e),await(0,b.Jt)({apiName:"backend",path:`/account/${o}/billing-portal-session`,options:{queryParams:s}}).response.then(e=>e.body.json()).then(e=>{const s=e.url;window.location.assign(s)}).catch(e=>{console.error("Error:",e.message),$(void 0)})},[o,O,Ie]),Ye=(0,c.useCallback)((e,s)=>{var n,i,a;let o="Confirm",r=(0,be.jsx)(be.Fragment,{});switch(s){case"cancel":o="Yes, Cancel",r=(0,be.jsxs)(be.Fragment,{children:[(0,be.jsx)(t.Heading,{level:3,marginBottom:"var(--mantine-spacing-md)",children:"Cancel Subscription"}),(0,be.jsxs)(m.E,{mb:"sm",children:["Your subscription will be canceled, but is still available until the end of your billing period on"," ",(0,be.jsx)("strong",{children:new Date(1e3*(null!==(n=e.subscription?.currentPeriodEnd)&&void 0!==n?n:0))?.toLocaleString("en")}),". If you change your mind, you can renew your subscription."]}),(0,be.jsx)(m.E,{fw:500,children:"Are you sure you want to cancel your subscription?"})]});break;case"cancel_schedule":o="Yes, Cancel",r=(0,be.jsxs)(be.Fragment,{children:[(0,be.jsx)(t.Heading,{level:3,marginBottom:"var(--mantine-spacing-md)",children:"Cancel Scheduled Change"}),(0,be.jsxs)(m.E,{mb:"sm",children:["If canceled, your subscription will continue with the original terms after"," ",(0,be.jsx)("strong",{children:new Date(1e3*(null!==(i=e.subscription?.currentPeriodEnd)&&void 0!==i?i:0))?.toLocaleString("en")}),"."]}),(0,be.jsx)(m.E,{fw:500,children:"Are you sure you want to cancel the scheduled change to your subscription?"})]});break;case"renew":o="Yes, Renew",r=(0,be.jsxs)(be.Fragment,{children:[(0,be.jsx)(t.Heading,{level:3,marginBottom:"var(--mantine-spacing-md)",children:"Renew Subscription"}),(0,be.jsxs)(m.E,{size:"sm",children:["This subscription will no longer be canceled. It will renew on"," ",new Date(1e3*(null!==(a=e.subscription?.currentPeriodEnd)&&void 0!==a?a:0))?.toLocaleString("en"),"."]})]})}X.jQ.openConfirmModal({children:r,labels:{confirm:o,cancel:"No"},confirmProps:{className:je["console-button"]},cancelProps:{variant:"outline",className:je["console-button-outline"]},withCloseButton:!1,onConfirm:()=>De.mutate({site:e,action:s}),zIndex:1e5,xOffset:"1dvh",yOffset:"1dvh",centered:!0})},[De]),{isError:Me}=(0,a.I)({queryKey:["account",o],queryFn:()=>async function(e){const s=await(0,b.Jt)({apiName:"backend",path:`/account/${e}`}).response;return await s.body.json()}(o).then(e=>(e?xe(e.customer?e?.customerId:null):"authenticated"!==q||o&&!Me||xe(null),e)).catch(()=>{ke(null)}),enabled:!!o&&"authenticated"===q}),{isError:Oe,isPending:$e}=(0,a.I)({queryKey:["site",o,r],queryFn:()=>async function(e,s,n){const i={apiName:"backend",path:`/account/${e}/site/${s}${n?"/settings":""}`,options:{headers:{}}};n&&(i.options.headers["X-Site-Key"]=n);const t=await(0,b.Jt)(i).response;return await t.body.json()}(o,r,l).then(e=>{var s;return Pe(null!==(s=e.subscriptionType)&&void 0!==s?s:null),ke(e.subscription),Ee(e),e}).catch(e=>{throw Ee(null),ke(null),e}),enabled:le}),Be=(0,c.useCallback)(async e=>{const s=e?e.subscriber:!!Ce;return fetch(WpSuite.restUrl+"/update-site-settings",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":F},body:JSON.stringify({accountId:e?e.accountId:o,siteId:e?e.siteId:r,siteKey:e?e.siteKey:l,lastUpdate:(new Date).getTime(),subscriber:s}),credentials:"same-origin"}).finally(()=>{e&&o!==e.accountId&&r!==e.siteId&&(Ee(null),e.accountId||Pe(null),W(e.accountId),Y(e.siteId),M(e.siteKey))})},[o,F,W,Y,M,r,l,Ce]),Ke=(0,me.n)({mutationFn:e=>Be(e),onSuccess:async e=>{if(e.ok)U.$e.show({title:(0,d.__)("Settings saved",x.TEXT_DOMAIN),message:(0,d.__)("Site settings saved successfully",x.TEXT_DOMAIN),color:"green",icon:(0,be.jsx)(H.A,{}),className:je.notification});else{const s=await e.json();console.error("Failed to connect site",s),U.$e.show({title:(0,d.__)("Error occured",x.TEXT_DOMAIN),message:s.message,color:"red",icon:(0,be.jsx)(J.A,{}),className:je.notification})}Ne.close("connect-your-site")},onError:e=>{U.$e.show({title:(0,d.__)("Error occured",x.TEXT_DOMAIN),message:e.message,color:"red",icon:(0,be.jsx)(J.A,{}),className:je.notification})}}),qe=(0,c.useCallback)(()=>(0,be.jsxs)(v.W,{shadow:"md",width:220,children:[(0,be.jsx)(v.W.Target,{children:(0,be.jsx)(E.$,{variant:"subtle",ml:"xs",leftSection:(0,be.jsx)(G.A,{size:16}),children:"Settings"})}),(0,be.jsxs)(v.W.Dropdown,{children:[(0,be.jsx)(v.W.Label,{children:"Site"}),o&&r&&(ve||Oe)?(0,be.jsxs)(be.Fragment,{children:[(0,be.jsx)(v.W.Item,{leftSection:(0,be.jsx)(V.A,{size:16}),onClick:()=>Ne.open("connect-your-site"),children:"Reconnect"}),(0,be.jsx)(v.W.Item,{leftSection:(0,be.jsx)(Z.A,{size:16}),onClick:()=>X.jQ.openConfirmModal({children:(0,be.jsxs)(be.Fragment,{children:[(0,be.jsx)(t.Heading,{level:3,marginBottom:"var(--mantine-spacing-md)",children:"Disconnect This Site"}),(0,be.jsx)(m.E,{mb:"sm",children:"Disconnecting this site will immediately remove all Pro settings â€“ including API Settings and Form-Field customizations â€“ from WordPress."}),(0,be.jsx)(m.E,{mb:"sm",children:"Any active subscription tied to this site will keep billing but won't deliver benefits until you reconnect."}),(0,be.jsx)(m.E,{mb:"sm",children:"If you later reconnect this same site, its previous settings will be restored; linking a different site will start with default settings."}),(0,be.jsx)(m.E,{fw:500,children:"Are you sure you want to disconnect this site from WP Suite?"})]}),labels:{confirm:"Yes, Disconnect",cancel:"No"},confirmProps:{className:je["console-button"]},cancelProps:{variant:"outline",className:je["console-button-outline"]},withCloseButton:!1,onConfirm:()=>Be({}),zIndex:1e5,xOffset:"1dvh",yOffset:"1dvh",centered:!0}),children:"Disconnect"}),(0,be.jsx)(v.W.Item,{leftSection:(0,be.jsx)(ee.A,{size:16}),onClick:async()=>{try{const e=await Be();if(e.ok)U.$e.show({title:(0,d.__)("Cache cleared",x.TEXT_DOMAIN),message:(0,d.__)("Front-end site configuration cleared successfully.",x.TEXT_DOMAIN),color:"green",icon:(0,be.jsx)(se.A,{}),className:je.notification});else{const s=await e.json();console.error("Failed to submit data",s),U.$e.show({title:(0,d.__)("Error occured",x.TEXT_DOMAIN),message:s.message,color:"red",icon:(0,be.jsx)(J.A,{}),className:je.notification})}}catch(e){U.$e.show({title:(0,d.__)("Error occured",x.TEXT_DOMAIN),message:e.message,color:"red",icon:(0,be.jsx)(J.A,{}),className:je.notification})}},children:"Clear Cache"}),"authenticated"===q&&(0,be.jsxs)(be.Fragment,{children:[(0,be.jsx)(v.W.Divider,{}),(0,be.jsx)(v.W.Label,{children:"Subscription"}),null===Ce&&(0,be.jsx)(v.W.Item,{leftSection:(0,be.jsx)(ne.A,{size:16}),onClick:()=>Fe(),disabled:i!==o,children:"Plans & Pricing"}),ve&&null!==Ce&&Ie&&!Me&&(0,be.jsxs)(be.Fragment,{children:[(0,be.jsx)(v.W.Item,{leftSection:(0,be.jsx)(ne.A,{size:16}),disabled:i!==o||!!O||!!B,onClick:()=>We(),children:"Manage Billing"}),(0,be.jsx)(v.W.Item,{leftSection:(0,be.jsx)(ie.A,{size:16}),disabled:i!==o||!!O||!!B,onClick:()=>We("update"),children:"Update"}),(Ie.cancelAtPeriodEnd||Ie.nextSubscriptionType&&Ie.nextSubscriptionType!==Ce)&&(0,be.jsx)(v.W.Item,{leftSection:(0,be.jsx)(te.A,{size:16}),disabled:i!==o||!!O||!!B,onClick:()=>Ye(ve,Ie.cancelAtPeriodEnd?"renew":"cancel_schedule"),children:Ie.cancelAtPeriodEnd?"Renew":"Cancel Scheduled Update"}),!Ie.cancelAtPeriodEnd&&(0,be.jsx)(v.W.Item,{leftSection:(0,be.jsx)(ae.A,{size:16}),disabled:i!==o||!!O||!!B,onClick:()=>Ye(ve,"cancel"),children:"Cancel"})]})]})]}):(0,be.jsx)(v.W.Item,{leftSection:(0,be.jsx)(V.A,{size:16}),onClick:()=>Ne.open("connect-your-site"),children:"Connect"})]})]}),[o,q,Be,O,Me,Oe,B,We,Ye,Fe,i,ve,r,Ne,Ie,Ce]);return(0,c.useEffect)(()=>{"authenticated"===q&&(0,y.T)().then(e=>ue(e?.email))},[n,q]),(0,c.useEffect)(()=>{o&&r&&(0,x.getConfig)("wpsuite").then(e=>e&&e.subscriptionType?Pe(e.subscriptionType):Pe(null))},[o,r]),(0,c.useEffect)(()=>{"authenticated"!==q&&"unauthenticated"!==q||(ze.invalidateQueries({queryKey:["accounts"]}),ze.invalidateQueries({queryKey:["sites",o]}),ze.invalidateQueries({queryKey:["site",o,r]}))},[o,s,q,ze,r]),(0,be.jsxs)(j.Y,{justify:"space-between",align:"stretch",w:"100%",wrap:"nowrap",style:{flexDirection:Ae?"column-reverse":"row-reverse"},children:[(0,be.jsxs)(S.a.Stack,{children:[(0,be.jsx)(S.a,{...Ne.register("connect-your-site"),withCloseButton:!0,size:400,centered:!0,zIndex:1e5,title:(0,be.jsx)(m.E,{size:"lg",fw:700,children:"Connect Your Site"}),children:(0,be.jsx)(t.Authenticator,{loginMechanisms:["email"],signUpAttributes:["email","family_name","given_name"],formFields:{signUp:{"custom:acknowledgement":{isRequired:!0,label:'By creating an account, you agree to our <a href="https://wpsuite.io/privacy-policy" target="_blank" rel="noopener noreferrer" class="dark-link">Privacy Policy</a> and <a href="https://wpsuite.io/terms-of-use" target="_blank" rel="noopener noreferrer" class="dark-link">Terms of Use</a>, including the binding arbitration clause and class action waiver in Section 9.2.',type:"checkbox"}}},children:(0,be.jsx)(Se,{authStatus:q,accountId:null!=i?i:o,siteId:r,siteKey:l,subscriber:!!Ce,onClose:()=>Ne.close("connect-your-site"),onConnect:e=>new Promise(s=>{Ke.mutate(e,{onSettled:()=>s()})})})})}),(0,be.jsx)(S.a,{...Ne.register("prices"),withCloseButton:!0,size:"xl",zIndex:1e5,centered:!0,title:(0,be.jsx)(m.E,{size:"lg",fw:700,children:"Plans and Pricing"}),onClose:()=>{fe(void 0),Ne.close("prices")},children:void 0!==ge&&void 0!==de&&o&&r&&(0,be.jsx)(j.Y,{justify:"center",mt:20,children:(0,be.jsxs)(h.B,{w:"100%",gap:20,children:[(0,be.jsx)(m.E,{children:"Choose the plan that fits your WordPress site!"}),(0,be.jsxs)(m.E,{size:"sm",children:["Start free with WP Suite core features. Upgrade to Pro to unlock advanced customization, integrations, and premium support across all WP Suite plugins."," ",(0,be.jsx)("a",{className:"dark-link",href:"/pricing/",children:"Pricing"})," ","page."]}),ge?(0,be.jsx)("stripe-pricing-table",{"pricing-table-id":e.pricingTable,"publishable-key":e.stripePublicKey,"client-reference-id":o+"-"+r,"customer-session-client-secret":ge}):(0,be.jsx)("stripe-pricing-table",{"pricing-table-id":e.pricingTable,"publishable-key":e.stripePublicKey,"client-reference-id":o+"-"+r,"customer-email":de}),(0,be.jsx)(j.Y,{align:"center",className:je.info,children:(0,be.jsxs)(I.s,{align:"start",direction:"column",className:je.text,gap:{base:10,sm:0},children:[(0,be.jsx)(k.h,{order:5,children:"Additional Information"}),(0,be.jsx)(C.B,{spacing:"xs",size:"xs",children:(0,be.jsx)(C.B.Item,{className:je.item,children:"All prices are net amounts. Applicable taxes (e.g., VAT, Sales Tax) may be added depending on your location and circumstances."})})]})})]})})})]}),"configuring"===q&&(0,be.jsx)(ye,{}),"unauthenticated"===q&&(0,be.jsxs)(P.Z,{p:"sm",withBorder:!0,w:{base:"100%",sm:"40%"},maw:{base:"100%",sm:300},children:[(0,be.jsx)(j.Y,{style:{borderBottom:"1px solid #e0e0e0"},mb:"md",children:(0,be.jsx)(m.E,{fw:500,children:"Account Information"})}),(0,be.jsxs)(j.Y,{gap:"xs",style:{justifyContent:"space-between"},children:[(0,be.jsxs)(j.Y,{gap:"xs",children:[(0,be.jsx)(oe.A,{size:16}),(0,be.jsx)(m.E,{size:"sm",children:"You are not signed in."})]}),(0,be.jsxs)(E.$,{variant:o&&r?"outline":"gradient",leftSection:(0,be.jsx)(re.A,{size:16}),onClick:()=>{L(),Ne.open("connect-your-site")},disabled:!s,children:["Sign In ",o&&r?"to Reconnect":"and Connect"," ","Your Site"]}),!s&&(0,be.jsxs)(A.j,{children:[(0,be.jsx)(A.j.Target,{children:(0,be.jsx)(T.M,{variant:"subtle",size:"xs",children:(0,be.jsx)(J.A,{size:16,color:"red"})})}),(0,be.jsx)(A.j.Dropdown,{maw:300,style:{zIndex:1e5},children:(0,be.jsxs)(m.E,{size:"sm",children:["ðŸ›‘ ",(0,be.jsx)("strong",{children:"Heads-up"}),": Configuration is temporarily unavailable. Please try again later â€” no action is needed on your side."]})})]})]})]}),"authenticated"===q&&(0,be.jsxs)(P.Z,{p:"sm",withBorder:!0,w:{base:"100%",sm:"40%"},maw:{base:"100%",sm:300},children:[(0,be.jsx)(j.Y,{style:{borderBottom:"1px solid #e0e0e0"},mb:"md",children:(0,be.jsx)(m.E,{fw:500,children:"Account Information"})}),null!=Ce&&!Ie&&(Me&&(0,be.jsx)(_.F,{color:"red",title:"Notice â€“ Limited functionality due to network error",icon:(0,be.jsx)(J.A,{}),w:"100%",children:(0,be.jsx)(m.E,{size:"sm",mb:"xs",children:"Youâ€™re logged in to WordPress as an admin, but configuration and PRO features are currently unavailable. Please try again later â€” no action is needed on your side."})})||(!$e&&!r||Oe)&&(0,be.jsx)(_.F,{color:"red",title:"Access denied â€“ You donâ€™t have access to this siteâ€™s PRO configuration",icon:(0,be.jsx)(J.A,{}),w:"100%",children:(0,be.jsx)(m.E,{size:"sm",mb:"xs",children:"Youâ€™re logged in to WordPress as an admin, but the Gatey account you used isnâ€™t on the allowed members list for this connected site."})})),(0,be.jsxs)(j.Y,{gap:"xs",style:{justifyContent:"space-between"},children:[!de&&(0,be.jsxs)(be.Fragment,{children:[(0,be.jsx)(g.E,{height:24,circle:!0}),(0,be.jsx)(we,{})]}),de&&(0,be.jsxs)(I.s,{gap:"xs",p:"sm",align:"center",children:[(0,be.jsx)(oe.A,{size:16}),(0,be.jsx)(m.E,{size:"sm",children:de})]}),(0,be.jsx)(E.$,{variant:"outline",onClick:()=>{ce(),xe(null)},leftSection:(0,be.jsx)(Z.A,{size:16}),children:"Sign Out"})]})]}),(0,be.jsxs)(P.Z,{p:"sm",withBorder:!0,w:{base:"100%",sm:"auto"},style:{flexGrow:1},children:[(0,be.jsx)(j.Y,{style:{borderBottom:"1px solid #e0e0e0"},mb:"md",children:(0,be.jsx)(m.E,{fw:500,children:"Site Details"})}),(0,be.jsxs)(N.x,{align:"center",style:{justifyContent:"space-between"},children:[(0,be.jsxs)(N.x.Col,{span:{base:12,sm:2},children:["Status"," ",Ae&&(0,be.jsx)(g.E,{display:"inline-grid",w:"fit-content",visible:void 0===ve&&$e,children:o&&r&&!Oe?(0,be.jsx)(z.E,{color:"green",miw:100,children:"Connected"}):(0,be.jsx)(z.E,{color:"grey",miw:120,children:o&&r?"Connected (unreachable)":"Not connected"})})]}),(0,be.jsx)(N.x.Col,{span:{base:12,sm:10},children:(0,be.jsxs)(I.s,{direction:{base:"column",sm:"row"},gap:"sm",align:"center",children:[!Ae&&(0,be.jsx)(g.E,{display:"inline-grid",w:"fit-content",visible:void 0===ve&&$e,children:o&&r&&!Oe?(0,be.jsx)(z.E,{color:"green",miw:100,children:"Connected"}):(0,be.jsx)(z.E,{color:"grey",miw:120,children:o&&r?"Connected (unreachable)":"Not connected"})}),ve&&(0,be.jsx)(g.E,{w:"100%",visible:void 0===ve&&$e,children:(0,be.jsx)(I.s,{bg:"gray.0",align:"center",p:"sm",style:{borderRadius:6},children:ve&&(0,be.jsx)(be.Fragment,{children:(0,be.jsxs)(h.B,{gap:2,style:{flexGrow:1},children:[(0,be.jsxs)(m.E,{size:"sm",fw:500,component:"div",children:["Site: ",ve.name," (id: ",ve.siteId,")",null!=Ce&&(0,be.jsxs)(A.j,{shadow:"md",width:Ae?_e:300,position:"bottom-start",offset:8,withArrow:!0,styles:Ae?{dropdown:{left:"20px"}}:{},children:[(0,be.jsx)(A.j.Target,{children:(0,be.jsx)(T.M,{variant:"subtle",size:"xs",className:je["info-icon"],children:(0,be.jsx)(H.A,{size:16})})}),(0,be.jsxs)(A.j.Dropdown,{style:{maxWidth:"calc(100vw - 2rem)"},children:[(0,be.jsx)(t.Heading,{level:4,marginBottom:"xs",children:"License Refresh"}),(0,be.jsxs)(m.E,{size:"sm",mb:"sm",children:["Send a"," ",(0,be.jsx)(m.E,{component:"span",fw:700,children:"GET"})," ","request to the URL below, including theÂ ",(0,be.jsx)(D.C,{mx:"xs",children:"X-Site-Key"})," header."]}),(0,be.jsxs)(m.E,{size:"sm",mb:"sm",children:["The server returns a JSON object; the value of its ",(0,be.jsx)(D.C,{children:"jws"})," property is the license content."]}),(0,be.jsxs)(m.E,{size:"sm",mb:"sm",children:["Save that value as ",(0,be.jsx)(D.C,{children:"lic.jws"})," in your siteâ€™sÂ ",(0,be.jsx)(D.C,{children:"/wp-content/uploads/hub-for-wpsuiteio/"})," ","directory."]}),(0,be.jsxs)(m.E,{size:"sm",mb:"sm",children:[(0,be.jsx)(m.E,{fw:600,component:"span",children:"Note:"})," ","the license file is valid for"," ",(0,be.jsx)("b",{children:"oneÂ month"}),". On"," ",(0,be.jsx)("b",{children:"staticÂ sites"}),", automate a refresh at least ",(0,be.jsx)("b",{children:"once a week"}),". On"," ",(0,be.jsx)("b",{children:"WordPress"})," sites, the Gatey plugin refreshes it automaticallyâ€”no manual action needed."]})," ",(0,be.jsxs)(m.E,{size:"sm",children:[(0,be.jsx)(m.E,{fw:600,component:"span",children:"URL:"})," ",(0,be.jsx)(D.C,{children:(0,be.jsx)("strong",{children:(0,be.jsx)("a",{href:"#",target:"_blank",rel:"noopener noreferrer",className:"dark-link",style:{textDecoration:"none"},onClick:e=>(e.preventDefault(),e.stopPropagation(),jQuery("#gatey-license-url-"+ve.siteId).trigger("select"),navigator.clipboard.writeText(n+"/account/"+ve.accountId+"/site/"+ve.siteId+"/license"),U.$e.show({title:"License URL copied",message:"License URL copied successfully.",color:"green",icon:(0,be.jsx)(H.A,{}),className:je.notification}),!1),children:(0,be.jsx)("span",{id:"gatey-license-url-"+ve.siteId,children:"copy"})})})}),(0,be.jsx)("br",{}),(0,be.jsx)(m.E,{fw:600,component:"span",children:"X-Site-Key:"})," ",(0,be.jsx)(D.C,{children:(0,be.jsx)("strong",{children:(0,be.jsx)("a",{href:"#",target:"_blank",rel:"noopener noreferrer",className:"dark-link",style:{textDecoration:"none"},onClick:e=>{var s;return e.preventDefault(),e.stopPropagation(),jQuery("#gatey-site-key-"+ve.siteId).trigger("select"),navigator.clipboard.writeText(null!==(s=ve.siteKey)&&void 0!==s?s:""),U.$e.show({title:"Site key copied",message:"Site key copied successfully.",color:"green",icon:(0,be.jsx)(H.A,{}),className:je.notification}),!1},children:(0,be.jsx)("span",{id:"gatey-site-key-"+ve.siteId,children:"copy"})})})})]})]})]})]}),ve.account&&(0,be.jsx)(be.Fragment,{children:(0,be.jsxs)(m.E,{size:"xs",c:"dimmed",component:"div",children:["Workspace: ",ve.account.name," (id:"," ",ve.account.accountId,", owner:"," ",(0,be.jsx)("a",{className:"dark-link",href:`mailto:${ve.account.ownerEmail}`,target:"_blank",rel:"noopener noreferrer",children:ve.account.ownerEmail}),")"]})})]})})})})]})}),(0,be.jsxs)(N.x.Col,{span:{base:12,sm:2},children:["Subscription"," ",Ae&&(0,be.jsxs)(be.Fragment,{children:[(0,be.jsxs)(g.E,{display:"inline-grid",w:"fit-content",visible:void 0===Ce,children:[null===Ce&&(0,be.jsx)(z.E,{color:"grey",miw:45,children:"FREE"}),"PROFESSIONAL"===Ce&&(0,be.jsx)(z.E,{color:"red",miw:35,children:"PRO"})]}),qe()]})]}),(0,be.jsx)(N.x.Col,{span:{base:12,sm:10},children:(0,be.jsxs)(I.s,{direction:{base:"column",sm:"row"},gap:"sm",align:"center",children:[" ",!Ae&&(0,be.jsxs)(g.E,{display:"inline-grid",w:"fit-content",visible:void 0===Ce,children:[null===Ce&&(0,be.jsx)(z.E,{color:"grey",miw:45,children:"FREE"}),"PROFESSIONAL"===Ce&&(0,be.jsx)(z.E,{color:"red",miw:35,children:"PRO"})]}),!!Ce&&(0,be.jsx)(j.Y,{gap:"xs",style:{justifyContent:"space-between"},children:(0,be.jsx)(g.E,{w:"100%",visible:void 0===Ce||null!==Ce&&!Ie&&$e,children:(0,be.jsx)(I.s,{bg:"gray.0",p:"sm",align:"center",style:{borderRadius:6,flexGrow:1},children:null!==Ce&&(0,be.jsx)(h.B,{gap:2,children:(0,be.jsxs)(m.E,{size:"sm",fw:500,component:"div",children:[Ie?Ie?.active?"Subscription active":"Subscription inactive":"Subscription inaccessible",Ie&&Ie.active&&Ie.cancelAtPeriodEnd&&(0,be.jsxs)(be.Fragment,{children:[" ","â€” expires on"," ",(0,be.jsx)("strong",{children:new Date(1e3*Ie.currentPeriodEnd).toLocaleDateString()})]}),Ie&&Ie.active&&!Ie.cancelAtPeriodEnd&&(0,be.jsxs)(be.Fragment,{children:[" ","â€” renews automatically"," ",Ie.nextSubscriptionType&&Ce!==Ie.nextSubscriptionType&&(0,be.jsxs)(be.Fragment,{children:["as a"," ",(0,be.jsx)("strong",{children:Ie.nextSubscriptionType})," ","subscription"," "]}),"on"," ",(0,be.jsx)("strong",{children:new Date(1e3*Ie.currentPeriodEnd).toLocaleDateString()})]})]})})})})}),!Ae&&qe()]})})]})]})]})};function ve(){return(0,be.jsxs)(be.Fragment,{children:[(0,be.jsx)(g.E,{w:{base:"100%",xs:350},height:80,mb:"md"}),(0,be.jsx)(g.E,{w:{base:"100%",xs:350},height:80,mb:"md"}),(0,be.jsx)(g.E,{w:{base:"100%",xs:350},height:80,mb:"md"})]})}const Ee=ge.Ikc({siteId:ge.YjP().optional(),name:ge.YjP(),domain:ge.YjP(),subscriptionType:ge.YjP().optional()});function Se({authStatus:e,accountId:s,siteId:n,siteKey:i,subscriber:o,onClose:r,onConnect:l}){const[u,p]=(0,c.useState)(!1),[y,w]=(0,c.useState)(!1),[f,v]=(0,c.useState)(1),[S,C]=(0,c.useState)(!1),[A,_]=(0,c.useState)(s),[N,D]=(0,c.useState)(n),[R,Q]=(0,c.useState)(i),[G,ee]=(0,c.useState)(o),[ne,ie]=(0,c.useState)(""),[te,ae]=(0,c.useState)("name"),[oe]=(0,L.o)(ne,200),re=(0,q.m)({mode:"uncontrolled",initialValues:{subscriptionType:"",siteId:"",name:"",domain:""},validate:(0,xe.s)(Ee)}),ge=(0,c.useCallback)(()=>(0,b.Jt)({apiName:"backendWithIam",path:"/account"}).response.then(e=>e.body.json()).then(e=>{const s=e;return A||_(s[0].accountId),s}).catch(e=>{throw console.error("Error fetching workspaces:",e),e}).finally(()=>{p(!1)}),[A]),ye=(0,c.useCallback)(({pageParam:e=null})=>(0,b.Jt)({apiName:"backend",path:`/account/${A}/site`,options:e?{queryParams:{limit:String(3),last_key:e,order:te,...oe?{search:oe}:{}}}:{queryParams:{limit:String(3),order:te,...oe?{search:oe}:{}}}}).response.then(e=>e.body.json()).then(e=>e).catch(e=>{throw console.error("Error fetching sites:",e),e}).finally(()=>{p(!1)}),[A,oe,te]),{data:we,isPending:fe,error:Se}=(0,a.I)({queryKey:["accounts"],queryFn:ge,enabled:"authenticated"===e}),{data:Ie,isPending:ke,error:Ce,fetchNextPage:Pe,hasNextPage:Ae,isFetchingNextPage:Te}=(0,pe.q)({queryKey:["sites",A,oe,te],queryFn:ye,initialPageParam:null,getNextPageParam:e=>{var s;return null!==(s=e.lastKey)&&void 0!==s?s:void 0},select:e=>({pages:e.pages.filter(e=>e.list.length>0)}),enabled:!!A&&"authenticated"===e}),_e=(0,c.useMemo)(()=>{var e;return null!==(e=Ie?.pages.flatMap(e=>e.list))&&void 0!==e?e:[]},[Ie]),Ne=(0,c.useMemo)(()=>{var e;return Math.max(null!==(e=Ie?.pages.length)&&void 0!==e?e:0,1)},[Ie]);Ne>0&&f>Ne&&(console.log("Adjusting active page from",f,"to",Ne),v(Ne));const ze=(0,c.useCallback)(e=>{e>Ne&&Ae?Pe().then(s=>{var n;v(Math.min(e,null!==(n=s?.data?.pages.length)&&void 0!==n?n:0))}):v(e)},[Pe,Ae,Ne]),De=(0,he.jE)(),Fe=(0,me.n)({mutationFn:async e=>{const s={name:e.name,domain:e.domain};return await(e.siteId&&""!==e.siteId.trim()?b.yJ({apiName:"backend",path:`/account/${A}/site/${e.siteId}`,options:{body:s}}):b.bE({apiName:"backend",path:`/account/${A}/site`,options:{body:s}})).response.then(e=>e.body.json()).then(e=>(U.$e.show({title:(0,d.__)("Site updated",x.TEXT_DOMAIN),message:(0,d.__)("Site updated successfully.",x.TEXT_DOMAIN),color:"green",icon:(0,be.jsx)(H.A,{}),className:je.notification}),e)).catch(e=>{console.error("Error:",e.message),U.$e.show({title:(0,d.__)("Error occured",x.TEXT_DOMAIN),message:e.message,color:"red",icon:(0,be.jsx)(J.A,{}),className:je.notification})})},onSuccess:()=>{De.invalidateQueries({queryKey:["sites",A]}),C(!1)},onError:e=>{U.$e.show({title:(0,d.__)("Error occured",x.TEXT_DOMAIN),message:e.message,color:"red",icon:(0,be.jsx)(J.A,{}),className:je.notification})}}),We=(0,me.n)({mutationFn:async e=>{await b.yH({apiName:"backend",path:`/account/${A}/site/${e}`}).response},onMutate:async e=>{await De.cancelQueries({queryKey:["sites"]});const s=De.getQueryData(["sites"]);return De.setQueryData(["sites"],s=>s?{...s,pages:s.pages.map(s=>({...s,list:s.list.filter(s=>s.siteId!==e)}))}:s),{prev:s}},onSuccess:()=>{De.invalidateQueries({queryKey:["sites",A]}),N===n&&(_(void 0),D(void 0),Q(void 0),ee(void 0))}}),Ye=(0,c.useMemo)(()=>{const e=3*(f-1);return _e?.slice(e,e+3)},[_e,f]);return fe?(0,be.jsx)(ve,{}):(0,be.jsxs)(be.Fragment,{children:[Se?(0,be.jsxs)(m.E,{c:"red",children:["Error: ",Se?.message]}):(0,be.jsxs)(be.Fragment,{children:[(we?.length>1||!we.find(e=>e.accountId===A))&&(0,be.jsx)(F.l,{label:"Select a workspace",description:"Select a workspace to manage sites",w:{base:"100%",xs:350},height:80,mb:"md",value:A,onChange:e=>{e&&(_(e),D(e===s?n:void 0),Q(e===s?i:void 0),ee(e===s?o:void 0),v(1),C(!1))},data:we.map(e=>({value:e.accountId,label:e.name})),classNames:{dropdown:je.dropdown}}),(0,be.jsxs)(W.s.Group,{label:"Select a site",description:"Select a site to connect this WordPress instance to",mb:"md",defaultValue:n+"|"+i+"|"+o,value:N+"|"+R+"|"+G,onChange:e=>{const s=e.split("|");D(s[0]),s.length>1&&Q(s[1]),s.length>2&&ee("true"===s[2])},children:[(0,be.jsxs)(j.Y,{gap:"xs",mt:"xs",children:[(0,be.jsx)(Y.I,{size:"xs",data:[{label:"Name",value:"name"},{label:"Domain",value:"domain"}],value:te,onChange:e=>ae(e)}),(0,be.jsx)(M.k,{placeholder:"Filterâ€¦",size:"xs",value:ne,onChange:e=>{ie(e.currentTarget.value),v(1)}})]}),(0,be.jsx)(g.E,{visible:Te||!!A&&"authenticated"===e&&(ke||u),mt:"md",mb:"md",children:(0,be.jsxs)(h.B,{pt:"md",mb:"md",gap:"xs",children:[(0,be.jsxs)(j.Y,{gap:"xs",style:{alignContent:"flex-start",overflowY:"auto"},children:[(!Ye?.length||0===Ye.length)&&!S&&(0,be.jsxs)(h.B,{align:"center",gap:"md",py:"xl",mb:"lg",w:{base:"100%",xs:350},children:[(0,be.jsx)(k.h,{order:4,children:"No Sites Found"}),(0,be.jsx)(m.E,{c:"dimmed",size:"sm",ta:"center",children:"You haven't added any sites yet."}),(0,be.jsx)(E.$,{variant:"gradient",size:"xs",leftSection:(0,be.jsx)(ce.A,{size:16}),onClick:()=>{re.setValues({subscriptionType:"",siteId:"",name:"",domain:""}),C(!0)},children:"Add a new site"})]}),!S&&Ye?.map(e=>(0,be.jsx)(W.s.Card,{className:je.radioCard,component:"div",p:"md",radius:"md",value:e.siteId+"|"+e.siteKey+"|"+(void 0!==e.subscription),disabled:S,children:(0,be.jsxs)(j.Y,{wrap:"nowrap",align:"flex-start",children:[(0,be.jsx)(W.s.Indicator,{}),(0,be.jsxs)(h.B,{gap:"xs",style:{flexGrow:1},children:[(0,be.jsxs)(m.E,{component:"div",fw:700,lh:1.3,size:"md",c:"bright",children:[e.name,e.domain===location.hostname.split(":")[0]&&(0,be.jsx)(z.E,{size:"xs",ml:"xs",variant:"light",children:"Current domain"})]}),(0,be.jsxs)(m.E,{c:"dimmed",size:"xs",children:[e.domain," "]})]}),(0,be.jsx)(O.m,{label:"Edit site",children:(0,be.jsx)(T.M,{variant:"subtle",size:"xs","aria-label":"Edit site",onClick:s=>{s.stopPropagation(),re.setValues({subscriptionType:e.subscriptionType,siteId:e.siteId,name:e.name,domain:e.domain}),C(!0)},children:(0,be.jsx)(le.A,{size:16})})}),(0,be.jsx)(O.m,{label:void 0!==e.subscriptionType?"Cannot delete site with active subscription":"Delete site",children:(0,be.jsx)(T.M,{variant:"subtle",size:"xs",color:"red","aria-label":void 0!==e.subscriptionType?"Cannot delete site with active subscription":"Delete site",disabled:void 0!==e.subscriptionType,onClick:s=>{s.stopPropagation(),X.jQ.openConfirmModal({children:(0,be.jsxs)(be.Fragment,{children:[(0,be.jsxs)(t.Heading,{level:3,marginBottom:"var(--mantine-spacing-md)",children:["Delete ",e.name,"?"]})," ",(0,be.jsx)(m.E,{mb:"sm",children:"This site does not have an active subscription, but it may still contain saved configuration settings from another WordPress instance."}),(0,be.jsx)(m.E,{mb:"sm",children:"Deleting this site will permanently remove all saved settings, and this action cannot be undone."}),(0,be.jsx)(m.E,{fw:500,children:"Are you sure you want to delete this site?"})]}),labels:{confirm:"Yes, Delete",cancel:"No"},confirmProps:{className:je["console-button"]},cancelProps:{variant:"outline",className:je["console-button-outline"]},withCloseButton:!1,onConfirm:()=>We.mutate(e.siteId),zIndex:100002,xOffset:"1dvh",yOffset:"1dvh",centered:!0})},children:(0,be.jsx)(se.A,{size:16})})})]})},e.siteId))]}),!S&&(0,be.jsx)($.d,{classNames:{root:je.pagination,control:je["pagination-control"]},total:Ae?Math.max(Ne,f+1):Ne,value:f,onChange:ze,mt:"md"}),S&&(0,be.jsxs)(P.Z,{component:"form",withBorder:!0,w:{base:"100%",xs:350},onSubmit:re.onSubmit(e=>{Fe.mutate({siteId:e.siteId,name:e.name,domain:e.domain})}),children:[(0,be.jsx)(B.p,{visible:Fe.isPending,zIndex:1e3,overlayProps:{radius:"md",blur:2}}),(0,be.jsx)(K.s,{children:(0,be.jsx)(M.k,{...re.getInputProps("siteId")},re.key("siteId"))}),(0,be.jsx)(M.k,{label:"Site name",placeholder:"My WordPress site",required:!0,...re.getInputProps("name")},re.key("name")),(0,be.jsx)(M.k,{label:"Licensed Domain",placeholder:"my-wordpress-site.com",required:!0,...re.getInputProps("domain")},re.key("domain")),(0,be.jsxs)(j.Y,{justify:"space-between",mt:"md",children:[(0,be.jsx)(E.$,{variant:"outline",size:"xs",leftSection:(0,be.jsx)(de.A,{size:16}),onClick:()=>C(!1),children:"Cancel"}),(0,be.jsx)(I.s,{gap:0,children:(0,be.jsx)(E.$,{type:"submit",variant:"gradient",size:"xs",leftSection:(0,be.jsx)(ue.A,{size:16}),children:"Save"})})]})]}),Ye&&(0,be.jsx)(j.Y,{justify:"center",children:(0,be.jsx)(E.$,{variant:"subtle",size:"xs",leftSection:(0,be.jsx)(ce.A,{size:16}),onClick:()=>{re.setValues({subscriptionType:"",siteId:"",name:"",domain:""}),C(!0)},disabled:S,children:"Add a new site"})})]})})]})]}),(0,be.jsxs)(j.Y,{justify:"space-between",children:[(0,be.jsx)(E.$,{variant:"outline",onClick:r,leftSection:(0,be.jsx)(Z.A,{size:16}),children:"Close"}),(0,be.jsx)(E.$,{variant:"gradient",onClick:()=>{w(!0),l({accountId:A,siteId:N,siteKey:R,subscriber:G}).then(()=>{w(!1)})},leftSection:(0,be.jsx)(V.A,{size:16}),disabled:!!Ce||S,loading:y,children:"Connect"})]})]})}const Ie=e=>((0,c.useEffect)(()=>{const e=document.createElement("script");e.src="https://js.stripe.com/v3/pricing-table.js",e.async=!0,document.head.appendChild(e)},[]),(0,be.jsx)(g.E,{visible:void 0===e.amplifyConfigured,width:"100%",mt:"md",children:void 0===e.amplifyConfigured?(0,be.jsx)(j.Y,{justify:"space-between",align:"stretch",w:"100%",h:"150px"}):(0,be.jsx)(fe,{...e})}));n(428);const ke="dev.wpsuite.io"===window.location.host?"https://api.wpsuite.io/dev":"https://api.wpsuite.io",Ce="dev.wpsuite.io"===window.location.host?"https://wpsuite.io/static/config/dev.json":"https://wpsuite.io/static/config/prod.json",Pe=e=>{const{nonce:s}=e,[n,g]=(0,c.useState)(),[j,b]=(0,c.useState)(),[y,w]=(0,c.useState)(WpSuite.siteSettings.accountId),[f,v]=(0,c.useState)(WpSuite.siteSettings.siteId),[E,S]=(0,c.useState)(WpSuite.siteSettings.siteKey),I=(0,p.U)(`(max-width: ${u.S.breakpoints.sm})`),{data:k}=(0,a.I)({queryKey:["config"],queryFn:async()=>{const e=await fetch(Ce).catch(e=>({ok:!0,statusText:e.message,json:async()=>({config:"prod",baseUrl:"https://wpsuite.io",userPoolId:"us-east-1_G0wEwK9tt",identityPoolId:"us-east-1:11e55c9a-b768-48a2-8a0c-c51f1e99c129",appClientPlugin:"5e6fs3pk1k1ju7cgpnp7o7si8u",awsRegion:"us-east-1",pricingTable:"prctbl_1QA6TQFjw5MDUzy6c3fBSPGL",stripePublicKey:"pk_live_51OVeJwFjw5MDUzy6pwTbsMjcBZjZioihzLAtxQsF91u4lYJC4mtqrJddSskhz6OPbWS0tr8XL2G1AwJaXEpv9Rgn008dAz5TEr",permissions:{owner:["transfer-account","manage-account","manage-sites","manage-subscriptions","manage-billing"],admin:["manage-account","manage-sites","manage-subscriptions","manage-billing"],accountant:["manage-billing"]}})}));if(!e.ok)throw console.error("Error loading configuration:",await e.json()),g(!1),new Error(e.statusText);const s=await e.json(),n={Auth:{Cognito:{userPoolId:s.userPoolId,userPoolClientId:s.appClientPlugin,identityPoolId:s.identityPoolId}},API:{REST:{backend:{endpoint:ke},backendWithIam:{endpoint:ke}}}},t={API:{REST:{headers:async e=>{if("backend"===e.apiName)try{const e=await(0,i.$)();if(e?.tokens?.accessToken)return{Authorization:`Bearer ${e.tokens.accessToken}`}}catch(e){console.error(e)}return{}}}}};return o.E.configure(n,t),await C(),g(!0),s}}),C=(0,c.useCallback)(async()=>{try{var e;const s=await(0,i.$)(),n=null!==(e=s.tokens?.accessToken.payload.scope?.split(" "))&&void 0!==e?e:[];if(b(void 0),y&&!n.includes("sc.account.owner."+y)&&!n.includes("sc.account.admin."+y)){console.error("You do not have permission to access this resource. Please contact site owner.");const e=n.find(e=>e.startsWith("sc.account.owner.")||e.startsWith("sc.account.admin."))?.split(".")[3];e&&b(e)}}catch(e){console.error(e),b(void 0)}},[y]);return(0,c.useEffect)(()=>{const e=r.YZ.listen("auth",e=>{const{payload:s}=e;"signedIn"!==s.event&&"signedOut"!==s.event||C()});return()=>{e()}},[C]),(0,be.jsx)(t.Authenticator.Provider,{children:(0,be.jsxs)("div",{className:"j7QpPcqW2jckSg1DEubK",children:[(0,be.jsxs)(h.B,{mb:"md",gap:4,children:[(0,be.jsx)(l.__experimentalHeading,{level:1,style:{display:"flex",alignItems:"center",gap:"8px",color:"#218BE6"},children:(0,d.__)(I?"WPSuite.io HUB":"Central Hub for WPSuite.io Plugins",x.TEXT_DOMAIN)}),(0,be.jsx)(m.E,{children:"Link this WordPress installation to your WP Suite workspace to enable licensing and shared features. You can disconnect or switch workspaces at any time without affecting your content."})]})," ",(0,be.jsx)(Ie,{apiUrl:ke,amplifyConfigured:n,nonce:s,stripePublicKey:k?.stripePublicKey,pricingTable:k?.pricingTable,accountId:y,ownAccountId:null!=j?j:y,siteId:f,siteKey:E,setAccountId:w,setSiteId:v,setSiteKey:S})]})})}}}]);