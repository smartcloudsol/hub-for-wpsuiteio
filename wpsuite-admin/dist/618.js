"use strict";(globalThis.webpackChunk_smart_cloud_wpsuite_admin=globalThis.webpackChunk_smart_cloud_wpsuite_admin||[]).push([[618],{5618:(e,s,n)=>{n.r(s),n.d(s,{default:()=>Te});var i=n(548),t=n(7597),a=n(7286),o=n(9095),r=n(6886),c=n(1609),l=n(6427),d=n(7723),u=n(5304),h=n(9019),m=n(7826),p=n(6945),x=n(3661),g=(n(1880),n(4759)),j=n(4285),b=n(8438),y=n(6496),w=n(5841),f=n(8149),v=n(6193),E=n(8693),S=n(5055),I=n(4999),k=n(1365),C=n(54),P=n(9652),A=n(4956),T=n(1179),_=n(2287),N=n(8324),z=n(132),D=n(9674),F=n(3976),W=n(3073),M=n(6713),O=n(460),Y=n(6995),$=n(7193),B=n(4039),K=n(905),q=n(5362),R=n(4577),L=n(9329),X=n(8649),U=n(4193),Q=n(8335),J=n(9543),G=n(6705),V=n(7641),Z=n(7693),H=n(6118),ee=n(8365),se=n(7167),ne=n(5421),ie=n(4225),te=n(9096),ae=n(2200),oe=n(2898),re=n(6319),ce=n(9232),le=n(2368),de=n(2449),ue=n(9637),he=n(4067),me=n(899),pe=n(7665),xe=n(7097),ge=n(6475),je=n(988),be=n(7909);const ye={info:"Tj85cyFPmCb5IuH3PLzT",item:"u_y0mHJV5dJDeaup7AnQ",warning:"mgJMlWizrI_1zV6gKDww",radioCard:"_tg59NZLBI4ufk2D9_x4",dropdown:"Dpk9BMBojJjovE83ymYi"};var we=n(790);function fe(){return(0,we.jsxs)(I.Y,{gap:"xs",children:[(0,we.jsx)(g.E,{height:24,circle:!0}),(0,we.jsx)(ve,{}),(0,we.jsx)(g.E,{height:48,width:300})]})}function ve(){return(0,we.jsxs)(h.B,{gap:"8px",children:[(0,we.jsx)(g.E,{height:8,width:100,radius:"xl"}),(0,we.jsx)(g.E,{height:8,width:100,radius:"xl"})]})}const Ee=e=>{const{amplifyConfigured:s,apiUrl:n,ownAccountId:i,accountId:o,siteId:r,siteKey:l,nonce:M,setAccountId:O,setSiteId:Y,setSiteKey:$}=e,[B,K]=(0,c.useState)(),[q,R]=(0,c.useState)(),{authStatus:L,toSignIn:U,signOut:de}=(0,y.A)((e=>[e.user,e.authStatus,e.route])),ue=!(!o||!r||"authenticated"!==L&&!l),[he,me]=(0,c.useState)(),[ge,je]=(0,c.useState)(),[be,Ee]=(0,c.useState)(),[Se,Ie]=(0,c.useState)(ue?void 0:null),[Ce,Pe]=(0,c.useState)(o||r?void 0:null),[Ae,Te]=(0,c.useState)(o||r?void 0:null),_e=(0,p.U)(`(max-width: ${u.S.breakpoints.sm})`),{width:Ne}=(0,X.l)(),ze=Math.min(300,Ne-parseInt((0,f.D)(32))),De=(0,v.e)(["connect-your-site","prices"]),Fe=(0,pe.jE)(),We=(0,xe.n)({mutationFn:({site:e,action:s})=>(R(s),(0,j.F6)({apiName:"backend",path:"/account/"+e.accountId+"/site/"+e.siteId,options:{queryParams:{action:s}}}).response.then((e=>e.body.json())).then((e=>(J.$e.show({title:(0,d.__)("Subscription changed",x.TEXT_DOMAIN),message:(0,d.__)("Subscription changed successfully.",x.TEXT_DOMAIN),color:"green",icon:(0,we.jsx)(G.A,{}),className:ye.notification}),e))).catch((e=>{console.error("Error:",e.message),J.$e.show({title:(0,d.__)("Error occured",x.TEXT_DOMAIN),message:e.message,color:"red",icon:(0,we.jsx)(V.A,{}),className:ye.notification}),Ee(null)})).finally((()=>{R(void 0)}))),onSuccess:()=>{Fe.invalidateQueries({queryKey:["site",o,r]})}}),Me=(0,c.useCallback)((async()=>{ge?(0,j.Jt)({apiName:"backend",path:`/account/${o}/billing-auth-session`}).response.then((e=>e.body.json())).then((e=>{Ee(e.token)})).catch((e=>{console.error("Error:",e.message),Ee(null)})):Ee(null),De.open("prices")}),[o,ge,De]),Oe=(0,c.useCallback)((async e=>{if(!Ce||B)return;K(null!=e?e:"manage");const s={next_url:window.location.href,subscription_id:Ce.id};e&&(s.type=e),await(0,j.Jt)({apiName:"backend",path:`/account/${o}/billing-portal-session`,options:{queryParams:s}}).response.then((e=>e.body.json())).then((e=>{const s=e.url;window.location.assign(s)})).catch((e=>{console.error("Error:",e.message),K(void 0)}))}),[o,B,Ce]),Ye=(0,c.useCallback)(((e,s)=>{var n,i,t;let a="Confirm",o=(0,we.jsx)(we.Fragment,{});switch(s){case"cancel":a="Yes, Cancel",o=(0,we.jsxs)(we.Fragment,{children:[(0,we.jsx)(w.D,{level:3,marginBottom:"var(--mantine-spacing-md)",children:"Cancel Subscription"}),(0,we.jsxs)(m.E,{mb:"sm",children:["Your subscription will be canceled, but is still available until the end of your billing period on"," ",(0,we.jsx)("strong",{children:new Date(1e3*(null!==(n=e.subscription?.currentPeriodEnd)&&void 0!==n?n:0))?.toLocaleString("en")}),". If you change your mind, you can renew your subscription."]}),(0,we.jsx)(m.E,{fw:500,children:"Are you sure you want to cancel your subscription?"})]});break;case"cancel_schedule":a="Yes, Cancel",o=(0,we.jsxs)(we.Fragment,{children:[(0,we.jsx)(w.D,{level:3,marginBottom:"var(--mantine-spacing-md)",children:"Cancel Scheduled Change"}),(0,we.jsxs)(m.E,{mb:"sm",children:["If canceled, your subscription will continue with the original terms after"," ",(0,we.jsx)("strong",{children:new Date(1e3*(null!==(i=e.subscription?.currentPeriodEnd)&&void 0!==i?i:0))?.toLocaleString("en")}),"."]}),(0,we.jsx)(m.E,{fw:500,children:"Are you sure you want to cancel the scheduled change to your subscription?"})]});break;case"renew":a="Yes, Renew",o=(0,we.jsxs)(we.Fragment,{children:[(0,we.jsx)(w.D,{level:3,marginBottom:"var(--mantine-spacing-md)",children:"Renew Subscription"}),(0,we.jsxs)(m.E,{size:"sm",children:["This subscription will no longer be canceled. It will renew on"," ",new Date(1e3*(null!==(t=e.subscription?.currentPeriodEnd)&&void 0!==t?t:0))?.toLocaleString("en"),"."]})]})}Q.jQ.openConfirmModal({children:o,labels:{confirm:a,cancel:"No"},confirmProps:{className:ye["console-button"]},cancelProps:{variant:"outline",className:ye["console-button-outline"]},withCloseButton:!1,onConfirm:()=>We.mutate({site:e,action:s}),zIndex:1e5,xOffset:"1dvh",yOffset:"1dvh",centered:!0})}),[We]),{isError:$e}=(0,a.I)({queryKey:["account",o],queryFn:()=>async function(e){const s=await(0,j.Jt)({apiName:"backend",path:`/account/${e}`}).response;return await s.body.json()}(o).then((e=>(e?je(e.customer?e?.customerId:null):"authenticated"!==L||o&&!$e||je(null),e))).catch((()=>{Pe(null)})),enabled:!!o&&"authenticated"===L}),{isError:Be,isPending:Ke}=(0,a.I)({queryKey:["site",o,r],queryFn:()=>async function(e,s,n){const i={apiName:"backend",path:`/account/${e}/site/${s}${n?"/settings":""}`,options:{headers:{}}};n&&(i.options.headers["X-Site-Key"]=n);const t=await(0,j.Jt)(i).response;return await t.body.json()}(o,r,l).then((e=>{var s;return Te(null!==(s=e.subscriptionType)&&void 0!==s?s:null),Pe(e.subscription),Ie(e),e})).catch((e=>{throw Ie(null),Pe(null),e})),enabled:ue}),qe=(0,c.useCallback)((async e=>{const s=e?e.subscriber:!!Ae;return fetch(WpSuite.restUrl+"/update-site-settings",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":M},body:JSON.stringify({accountId:e?e.accountId:o,siteId:e?e.siteId:r,siteKey:e?e.siteKey:l,lastUpdate:(new Date).getTime(),subscriber:s}),credentials:"same-origin"}).finally((()=>{e&&o!==e.accountId&&r!==e.siteId&&(Ie(null),e.accountId||Te(null),O(e.accountId),Y(e.siteId),$(e.siteKey))}))}),[o,M,O,Y,$,r,l,Ae]),Re=(0,xe.n)({mutationFn:e=>qe(e),onSuccess:async e=>{if(e.ok)J.$e.show({title:(0,d.__)("Settings saved",x.TEXT_DOMAIN),message:(0,d.__)("Site settings saved successfully",x.TEXT_DOMAIN),color:"green",icon:(0,we.jsx)(Z.A,{}),className:ye.notification});else{const s=await e.json();console.error("Failed to connect site",s),J.$e.show({title:(0,d.__)("Error occured",x.TEXT_DOMAIN),message:s.message,color:"red",icon:(0,we.jsx)(V.A,{}),className:ye.notification})}De.close("connect-your-site")},onError:e=>{J.$e.show({title:(0,d.__)("Error occured",x.TEXT_DOMAIN),message:e.message,color:"red",icon:(0,we.jsx)(V.A,{}),className:ye.notification})}}),Le=(0,c.useCallback)((()=>(0,we.jsxs)(E.W,{shadow:"md",width:220,children:[(0,we.jsx)(E.W.Target,{children:(0,we.jsx)(S.$,{variant:"subtle",ml:"xs",leftSection:(0,we.jsx)(H.A,{size:16}),children:"Settings"})}),(0,we.jsxs)(E.W.Dropdown,{children:[(0,we.jsx)(E.W.Label,{children:"Site"}),o&&r&&(Se||Be)?(0,we.jsxs)(we.Fragment,{children:[(0,we.jsx)(E.W.Item,{leftSection:(0,we.jsx)(ee.A,{size:16}),onClick:()=>De.open("connect-your-site"),children:"Reconnect"}),(0,we.jsx)(E.W.Item,{leftSection:(0,we.jsx)(se.A,{size:16}),onClick:()=>Q.jQ.openConfirmModal({children:(0,we.jsxs)(we.Fragment,{children:[(0,we.jsx)(w.D,{level:3,marginBottom:"var(--mantine-spacing-md)",children:"Disconnect This Site"}),(0,we.jsx)(m.E,{mb:"sm",children:"Disconnecting this site will immediately remove all Pro settings â€“ including API Settings and Form-Field customizations â€“ from WordPress."}),(0,we.jsx)(m.E,{mb:"sm",children:"Any active subscription tied to this site will keep billing but won't deliver benefits until you reconnect."}),(0,we.jsx)(m.E,{mb:"sm",children:"If you later reconnect this same site, its previous settings will be restored; linking a different site will start with default settings."}),(0,we.jsx)(m.E,{fw:500,children:"Are you sure you want to disconnect this site from WP Suite?"})]}),labels:{confirm:"Yes, Disconnect",cancel:"No"},confirmProps:{className:ye["console-button"]},cancelProps:{variant:"outline",className:ye["console-button-outline"]},withCloseButton:!1,onConfirm:()=>qe({}),zIndex:1e5,xOffset:"1dvh",yOffset:"1dvh",centered:!0}),children:"Disconnect"}),(0,we.jsx)(E.W.Item,{leftSection:(0,we.jsx)(ne.A,{size:16}),onClick:async()=>{try{const e=await qe();if(e.ok)J.$e.show({title:(0,d.__)("Cache cleared",x.TEXT_DOMAIN),message:(0,d.__)("Front-end site configuration cleared successfully.",x.TEXT_DOMAIN),color:"green",icon:(0,we.jsx)(ie.A,{}),className:ye.notification});else{const s=await e.json();console.error("Failed to submit data",s),J.$e.show({title:(0,d.__)("Error occured",x.TEXT_DOMAIN),message:s.message,color:"red",icon:(0,we.jsx)(V.A,{}),className:ye.notification})}}catch(e){J.$e.show({title:(0,d.__)("Error occured",x.TEXT_DOMAIN),message:e.message,color:"red",icon:(0,we.jsx)(V.A,{}),className:ye.notification})}},children:"Clear Cache"}),"authenticated"===L&&(0,we.jsxs)(we.Fragment,{children:[(0,we.jsx)(E.W.Divider,{}),(0,we.jsx)(E.W.Label,{children:"Subscription"}),null===Ae&&(0,we.jsx)(E.W.Item,{leftSection:(0,we.jsx)(te.A,{size:16}),onClick:()=>Me(),disabled:i!==o,children:"Plans & Pricing"}),Se&&null!==Ae&&Ce&&!$e&&(0,we.jsxs)(we.Fragment,{children:[(0,we.jsx)(E.W.Item,{leftSection:(0,we.jsx)(te.A,{size:16}),disabled:i!==o||!!B||!!q,onClick:()=>Oe(),children:"Manage Billing"}),(0,we.jsx)(E.W.Item,{leftSection:(0,we.jsx)(ae.A,{size:16}),disabled:i!==o||!!B||!!q,onClick:()=>Oe("update"),children:"Update"}),(Ce.cancelAtPeriodEnd||Ce.nextSubscriptionType&&Ce.nextSubscriptionType!==Ae)&&(0,we.jsx)(E.W.Item,{leftSection:(0,we.jsx)(oe.A,{size:16}),disabled:i!==o||!!B||!!q,onClick:()=>Ye(Se,Ce.cancelAtPeriodEnd?"renew":"cancel_schedule"),children:Ce.cancelAtPeriodEnd?"Renew":"Cancel Scheduled Update"}),!Ce.cancelAtPeriodEnd&&(0,we.jsx)(E.W.Item,{leftSection:(0,we.jsx)(re.A,{size:16}),disabled:i!==o||!!B||!!q,onClick:()=>Ye(Se,"cancel"),children:"Cancel"})]})]})]}):(0,we.jsx)(E.W.Item,{leftSection:(0,we.jsx)(ee.A,{size:16}),onClick:()=>De.open("connect-your-site"),children:"Connect"})]})]})),[o,L,qe,B,$e,Be,q,Oe,Ye,Me,i,Se,r,De,Ce,Ae]);return(0,c.useEffect)((()=>{"authenticated"===L&&(0,b.T)().then((e=>me(e?.email)))}),[n,L]),(0,c.useEffect)((()=>{o&&r&&(0,x.getConfig)("wpsuite").then((e=>e&&e.subscriptionType?Te(e.subscriptionType):Te(null)))}),[o,r]),(0,c.useEffect)((()=>{"authenticated"!==L&&"unauthenticated"!==L||(Fe.invalidateQueries({queryKey:["accounts"]}),Fe.invalidateQueries({queryKey:["sites",o]}),Fe.invalidateQueries({queryKey:["site",o,r]}))}),[o,s,L,Fe,r]),(0,we.jsxs)(I.Y,{justify:"space-between",align:"stretch",w:"100%",wrap:"nowrap",style:{flexDirection:_e?"column-reverse":"row-reverse"},children:[(0,we.jsxs)(k.a.Stack,{children:[(0,we.jsx)(k.a,{...De.register("connect-your-site"),withCloseButton:!0,size:400,centered:!0,zIndex:1e5,title:(0,we.jsx)(m.E,{size:"lg",fw:700,children:"Connect Your Site"}),children:(0,we.jsx)(t.k,{loginMechanisms:["email"],signUpAttributes:["email","family_name","given_name"],formFields:{signUp:{"custom:acknowledgement":{isRequired:!0,label:'By creating an account, you agree to our <a href="https://wpsuite.io/privacy-policy" target="_blank" rel="noopener noreferrer" class="dark-link">Privacy Policy</a> and <a href="https://wpsuite.io/terms-of-use" target="_blank" rel="noopener noreferrer" class="dark-link">Terms of Use</a>, including the binding arbitration clause and class action waiver in Section 9.2.',type:"checkbox"}}},children:(0,we.jsx)(ke,{authStatus:L,accountId:null!=i?i:o,siteId:r,siteKey:l,subscriber:!!Ae,onClose:()=>De.close("connect-your-site"),onConnect:e=>new Promise((s=>{Re.mutate(e,{onSettled:()=>s()})}))})})}),(0,we.jsx)(k.a,{...De.register("prices"),withCloseButton:!0,size:"xl",zIndex:1e5,centered:!0,title:(0,we.jsx)(m.E,{size:"lg",fw:700,children:"Plans and Pricing"}),onClose:()=>{Ee(void 0),De.close("prices")},children:void 0!==be&&void 0!==he&&o&&r&&(0,we.jsx)(I.Y,{justify:"center",mt:20,children:(0,we.jsxs)(h.B,{w:"100%",gap:20,children:[(0,we.jsx)(m.E,{children:"Choose the plan that fits your WordPress site!"}),(0,we.jsxs)(m.E,{size:"sm",children:["Start free with WP Suite core features. Upgrade to Pro to unlock advanced customization, integrations, and premium support across all WP Suite plugins."," ",(0,we.jsx)("a",{className:"dark-link",href:"/pricing/",children:"Pricing"})," ","page."]}),be?(0,we.jsx)("stripe-pricing-table",{"pricing-table-id":e.pricingTable,"publishable-key":e.stripePublicKey,"client-reference-id":o+"-"+r,"customer-session-client-secret":be}):(0,we.jsx)("stripe-pricing-table",{"pricing-table-id":e.pricingTable,"publishable-key":e.stripePublicKey,"client-reference-id":o+"-"+r,"customer-email":he}),(0,we.jsx)(I.Y,{align:"center",className:ye.info,children:(0,we.jsxs)(C.s,{align:"start",direction:"column",className:ye.text,gap:{base:10,sm:0},children:[(0,we.jsx)(P.h,{order:5,children:"Additional Information"}),(0,we.jsx)(A.B,{spacing:"xs",size:"xs",children:(0,we.jsx)(A.B.Item,{className:ye.item,children:"All prices are net amounts. Applicable taxes (e.g., VAT, Sales Tax) may be added depending on your location and circumstances."})})]})})]})})})]}),"configuring"===L&&(0,we.jsx)(fe,{}),"unauthenticated"===L&&(0,we.jsxs)(T.Z,{p:"sm",withBorder:!0,w:{base:"100%",sm:"40%"},maw:{base:"100%",sm:300},children:[(0,we.jsx)(I.Y,{style:{borderBottom:"1px solid #e0e0e0"},mb:"md",children:(0,we.jsx)(m.E,{fw:500,children:"Account Information"})}),(0,we.jsxs)(I.Y,{gap:"xs",style:{justifyContent:"space-between"},children:[(0,we.jsxs)(I.Y,{gap:"xs",children:[(0,we.jsx)(ce.A,{size:16}),(0,we.jsx)(m.E,{size:"sm",children:"You are not signed in."})]}),(0,we.jsxs)(S.$,{variant:o&&r?"outline":"gradient",leftSection:(0,we.jsx)(le.A,{size:16}),onClick:()=>{U(),De.open("connect-your-site")},disabled:!s,children:["Sign In ",o&&r?"to Reconnect":"and Connect"," ","Your Site"]}),!s&&(0,we.jsxs)(_.j,{children:[(0,we.jsx)(_.j.Target,{children:(0,we.jsx)(N.M,{variant:"subtle",size:"xs",children:(0,we.jsx)(V.A,{size:16,color:"red"})})}),(0,we.jsx)(_.j.Dropdown,{maw:300,style:{zIndex:1e5},children:(0,we.jsxs)(m.E,{size:"sm",children:["ðŸ›‘ ",(0,we.jsx)("strong",{children:"Heads-up"}),": Configuration is temporarily unavailable. Please try again later â€” no action is needed on your side."]})})]})]})]}),"authenticated"===L&&(0,we.jsxs)(T.Z,{p:"sm",withBorder:!0,w:{base:"100%",sm:"40%"},maw:{base:"100%",sm:300},children:[(0,we.jsx)(I.Y,{style:{borderBottom:"1px solid #e0e0e0"},mb:"md",children:(0,we.jsx)(m.E,{fw:500,children:"Account Information"})}),null!=Ae&&!Ce&&($e&&(0,we.jsx)(z.F,{color:"red",title:"Notice â€“ Limited functionality due to network error",icon:(0,we.jsx)(V.A,{}),w:"100%",children:(0,we.jsx)(m.E,{size:"sm",mb:"xs",children:"Youâ€™re logged in to WordPress as an admin, but configuration and PRO features are currently unavailable. Please try again later â€” no action is needed on your side."})})||(!Ke&&!r||Be)&&(0,we.jsx)(z.F,{color:"red",title:"Access denied â€“ You donâ€™t have access to this siteâ€™s PRO configuration",icon:(0,we.jsx)(V.A,{}),w:"100%",children:(0,we.jsx)(m.E,{size:"sm",mb:"xs",children:"Youâ€™re logged in to WordPress as an admin, but the Gatey account you used isnâ€™t on the allowed members list for this connected site."})})),(0,we.jsxs)(I.Y,{gap:"xs",style:{justifyContent:"space-between"},children:[!he&&(0,we.jsxs)(we.Fragment,{children:[(0,we.jsx)(g.E,{height:24,circle:!0}),(0,we.jsx)(ve,{})]}),he&&(0,we.jsxs)(C.s,{gap:"xs",p:"sm",align:"center",children:[(0,we.jsx)(ce.A,{size:16}),(0,we.jsx)(m.E,{size:"sm",children:he})]}),(0,we.jsx)(S.$,{variant:"outline",onClick:()=>{de(),je(null)},leftSection:(0,we.jsx)(se.A,{size:16}),children:"Sign Out"})]})]}),(0,we.jsxs)(T.Z,{p:"sm",withBorder:!0,w:{base:"100%",sm:"auto"},style:{flexGrow:1},children:[(0,we.jsx)(I.Y,{style:{borderBottom:"1px solid #e0e0e0"},mb:"md",children:(0,we.jsx)(m.E,{fw:500,children:"Site Details"})}),(0,we.jsxs)(D.x,{align:"center",style:{justifyContent:"space-between"},children:[(0,we.jsxs)(D.x.Col,{span:{base:12,sm:2},children:["Status"," ",_e&&(0,we.jsx)(g.E,{display:"inline-grid",w:"fit-content",visible:void 0===Se&&Ke,children:o&&r&&!Be?(0,we.jsx)(F.E,{color:"green",miw:100,children:"Connected"}):(0,we.jsx)(F.E,{color:"grey",miw:120,children:o&&r?"Connected (unreachable)":"Not connected"})})]}),(0,we.jsx)(D.x.Col,{span:{base:12,sm:10},children:(0,we.jsxs)(C.s,{direction:{base:"column",sm:"row"},gap:"sm",align:"center",children:[!_e&&(0,we.jsx)(g.E,{display:"inline-grid",w:"fit-content",visible:void 0===Se&&Ke,children:o&&r&&!Be?(0,we.jsx)(F.E,{color:"green",miw:100,children:"Connected"}):(0,we.jsx)(F.E,{color:"grey",miw:120,children:o&&r?"Connected (unreachable)":"Not connected"})}),Se&&(0,we.jsx)(g.E,{w:"100%",visible:void 0===Se&&Ke,children:(0,we.jsx)(C.s,{bg:"gray.0",align:"center",p:"sm",style:{borderRadius:6},children:Se&&(0,we.jsx)(we.Fragment,{children:(0,we.jsxs)(h.B,{gap:2,style:{flexGrow:1},children:[(0,we.jsxs)(m.E,{size:"sm",fw:500,component:"div",children:["Site: ",Se.name," (id: ",Se.siteId,")",null!=Ae&&(0,we.jsxs)(_.j,{shadow:"md",width:_e?ze:300,position:"bottom-start",offset:8,withArrow:!0,styles:_e?{dropdown:{left:"20px"}}:{},children:[(0,we.jsx)(_.j.Target,{children:(0,we.jsx)(N.M,{variant:"subtle",size:"xs",className:ye["info-icon"],children:(0,we.jsx)(Z.A,{size:16})})}),(0,we.jsxs)(_.j.Dropdown,{style:{maxWidth:"calc(100vw - 2rem)"},children:[(0,we.jsx)(w.D,{level:4,marginBottom:"xs",children:"License Refresh"}),(0,we.jsxs)(m.E,{size:"sm",mb:"sm",children:["Send a"," ",(0,we.jsx)(m.E,{component:"span",fw:700,children:"GET"})," ","request to the URL below, including theÂ ",(0,we.jsx)(W.C,{mx:"xs",children:"X-Site-Key"})," header."]}),(0,we.jsxs)(m.E,{size:"sm",mb:"sm",children:["The server returns a JSON object; the value of its ",(0,we.jsx)(W.C,{children:"jws"})," property is the license content."]}),(0,we.jsxs)(m.E,{size:"sm",mb:"sm",children:["Save that value as ",(0,we.jsx)(W.C,{children:"lic.jws"})," in your siteâ€™sÂ ",(0,we.jsx)(W.C,{children:"/wp-content/uploads/hub-for-wpsuiteio/"})," ","directory."]}),(0,we.jsxs)(m.E,{size:"sm",mb:"sm",children:[(0,we.jsx)(m.E,{fw:600,component:"span",children:"Note:"})," ","the license file is valid for"," ",(0,we.jsx)("b",{children:"oneÂ month"}),". On"," ",(0,we.jsx)("b",{children:"staticÂ sites"}),", automate a refresh at least ",(0,we.jsx)("b",{children:"once a week"}),". On"," ",(0,we.jsx)("b",{children:"WordPress"})," sites, the Gatey plugin refreshes it automaticallyâ€”no manual action needed."]})," ",(0,we.jsxs)(m.E,{size:"sm",children:[(0,we.jsx)(m.E,{fw:600,component:"span",children:"URL:"})," ",(0,we.jsx)(W.C,{children:(0,we.jsx)("strong",{children:(0,we.jsx)("a",{href:"#",target:"_blank",rel:"noopener noreferrer",className:"dark-link",style:{textDecoration:"none"},onClick:e=>(e.preventDefault(),e.stopPropagation(),jQuery("#gatey-license-url-"+Se.siteId).trigger("select"),navigator.clipboard.writeText(n+"/account/"+Se.accountId+"/site/"+Se.siteId+"/license"),J.$e.show({title:"License URL copied",message:"License URL copied successfully.",color:"green",icon:(0,we.jsx)(Z.A,{}),className:ye.notification}),!1),children:(0,we.jsx)("span",{id:"gatey-license-url-"+Se.siteId,children:"copy"})})})}),(0,we.jsx)("br",{}),(0,we.jsx)(m.E,{fw:600,component:"span",children:"X-Site-Key:"})," ",(0,we.jsx)(W.C,{children:(0,we.jsx)("strong",{children:(0,we.jsx)("a",{href:"#",target:"_blank",rel:"noopener noreferrer",className:"dark-link",style:{textDecoration:"none"},onClick:e=>{var s;return e.preventDefault(),e.stopPropagation(),jQuery("#gatey-site-key-"+Se.siteId).trigger("select"),navigator.clipboard.writeText(null!==(s=Se.siteKey)&&void 0!==s?s:""),J.$e.show({title:"Site key copied",message:"Site key copied successfully.",color:"green",icon:(0,we.jsx)(Z.A,{}),className:ye.notification}),!1},children:(0,we.jsx)("span",{id:"gatey-site-key-"+Se.siteId,children:"copy"})})})})]})]})]})]}),Se.account&&(0,we.jsx)(we.Fragment,{children:(0,we.jsxs)(m.E,{size:"xs",c:"dimmed",component:"div",children:["Workspace: ",Se.account.name," (id:"," ",Se.account.accountId,", owner:"," ",(0,we.jsx)("a",{className:"dark-link",href:`mailto:${Se.account.ownerEmail}`,target:"_blank",rel:"noopener noreferrer",children:Se.account.ownerEmail}),")"]})})]})})})})]})}),(0,we.jsxs)(D.x.Col,{span:{base:12,sm:2},children:["Subscription"," ",_e&&(0,we.jsxs)(we.Fragment,{children:[(0,we.jsxs)(g.E,{display:"inline-grid",w:"fit-content",visible:void 0===Ae,children:[null===Ae&&(0,we.jsx)(F.E,{color:"grey",miw:45,children:"FREE"}),"PROFESSIONAL"===Ae&&(0,we.jsx)(F.E,{color:"red",miw:35,children:"PRO"})]}),Le()]})]}),(0,we.jsx)(D.x.Col,{span:{base:12,sm:10},children:(0,we.jsxs)(C.s,{direction:{base:"column",sm:"row"},gap:"sm",align:"center",children:[" ",!_e&&(0,we.jsxs)(g.E,{display:"inline-grid",w:"fit-content",visible:void 0===Ae,children:[null===Ae&&(0,we.jsx)(F.E,{color:"grey",miw:45,children:"FREE"}),"PROFESSIONAL"===Ae&&(0,we.jsx)(F.E,{color:"red",miw:35,children:"PRO"})]}),!!Ae&&(0,we.jsx)(I.Y,{gap:"xs",style:{justifyContent:"space-between"},children:(0,we.jsx)(g.E,{w:"100%",visible:void 0===Ae||null!==Ae&&!Ce&&Ke,children:(0,we.jsx)(C.s,{bg:"gray.0",p:"sm",align:"center",style:{borderRadius:6,flexGrow:1},children:null!==Ae&&(0,we.jsx)(h.B,{gap:2,children:(0,we.jsxs)(m.E,{size:"sm",fw:500,component:"div",children:[Ce?Ce?.active?"Subscription active":"Subscription inactive":"Subscription inaccessible",Ce&&Ce.active&&Ce.cancelAtPeriodEnd&&(0,we.jsxs)(we.Fragment,{children:[" ","â€” expires on"," ",(0,we.jsx)("strong",{children:new Date(1e3*Ce.currentPeriodEnd).toLocaleDateString()})]}),Ce&&Ce.active&&!Ce.cancelAtPeriodEnd&&(0,we.jsxs)(we.Fragment,{children:[" ","â€” renews automatically"," ",Ce.nextSubscriptionType&&Ae!==Ce.nextSubscriptionType&&(0,we.jsxs)(we.Fragment,{children:["as a"," ",(0,we.jsx)("strong",{children:Ce.nextSubscriptionType})," ","subscription"," "]}),"on"," ",(0,we.jsx)("strong",{children:new Date(1e3*Ce.currentPeriodEnd).toLocaleDateString()})]})]})})})})}),!_e&&Le()]})})]})]})]})};function Se(){return(0,we.jsxs)(we.Fragment,{children:[(0,we.jsx)(g.E,{w:{base:"100%",xs:350},height:80,mb:"md"}),(0,we.jsx)(g.E,{w:{base:"100%",xs:350},height:80,mb:"md"}),(0,we.jsx)(g.E,{w:{base:"100%",xs:350},height:80,mb:"md"})]})}const Ie=be.Ikc({siteId:be.YjP().optional(),name:be.YjP(),domain:be.YjP(),subscriptionType:be.YjP().optional()});function ke({authStatus:e,accountId:s,siteId:n,siteKey:i,subscriber:t,onClose:o,onConnect:r}){const[l,u]=(0,c.useState)(!1),[p,b]=(0,c.useState)(!1),[y,f]=(0,c.useState)(1),[v,E]=(0,c.useState)(!1),[k,A]=(0,c.useState)(s),[_,z]=(0,c.useState)(n),[D,W]=(0,c.useState)(i),[X,G]=(0,c.useState)(t),[H,ne]=(0,c.useState)(""),[te,ae]=(0,c.useState)("name"),[oe]=(0,U.o)(H,200),re=(0,L.m)({mode:"uncontrolled",initialValues:{subscriptionType:"",siteId:"",name:"",domain:""},validate:(0,je.s)(Ie)}),ce=(0,c.useCallback)((()=>(0,j.Jt)({apiName:"backendWithIam",path:"/account"}).response.then((e=>e.body.json())).then((e=>{const s=e;return k||A(s[0].accountId),s})).catch((e=>{throw console.error("Error fetching workspaces:",e),e})).finally((()=>{u(!1)}))),[k]),le=(0,c.useCallback)((({pageParam:e=null})=>(0,j.Jt)({apiName:"backend",path:`/account/${k}/site`,options:e?{queryParams:{limit:String(3),last_key:e,order:te,...oe?{search:oe}:{}}}:{queryParams:{limit:String(3),order:te,...oe?{search:oe}:{}}}}).response.then((e=>e.body.json())).then((e=>e)).catch((e=>{throw console.error("Error fetching sites:",e),e})).finally((()=>{u(!1)}))),[k,oe,te]),{data:be,isPending:fe,error:ve}=(0,a.I)({queryKey:["accounts"],queryFn:ce,enabled:"authenticated"===e}),{data:Ee,isPending:ke,error:Ce,fetchNextPage:Pe,hasNextPage:Ae,isFetchingNextPage:Te}=(0,ge.q)({queryKey:["sites",k,oe,te],queryFn:le,initialPageParam:null,getNextPageParam:e=>{var s;return null!==(s=e.lastKey)&&void 0!==s?s:void 0},select:e=>({pages:e.pages.filter((e=>e.list.length>0))}),enabled:!!k&&"authenticated"===e}),_e=(0,c.useMemo)((()=>{var e;return null!==(e=Ee?.pages.flatMap((e=>e.list)))&&void 0!==e?e:[]}),[Ee]),Ne=(0,c.useMemo)((()=>{var e;return Math.max(null!==(e=Ee?.pages.length)&&void 0!==e?e:0,1)}),[Ee]);Ne>0&&y>Ne&&(console.log("Adjusting active page from",y,"to",Ne),f(Ne));const ze=(0,c.useCallback)((e=>{e>Ne&&Ae?Pe().then((s=>{var n;f(Math.min(e,null!==(n=s?.data?.pages.length)&&void 0!==n?n:0))})):f(e)}),[Pe,Ae,Ne]),De=(0,pe.jE)(),Fe=(0,xe.n)({mutationFn:async e=>{const s={name:e.name,domain:e.domain};return await(e.siteId&&""!==e.siteId.trim()?j.yJ({apiName:"backend",path:`/account/${k}/site/${e.siteId}`,options:{body:s}}):j.bE({apiName:"backend",path:`/account/${k}/site`,options:{body:s}})).response.then((e=>e.body.json())).then((e=>(J.$e.show({title:(0,d.__)("Site updated",x.TEXT_DOMAIN),message:(0,d.__)("Site updated successfully.",x.TEXT_DOMAIN),color:"green",icon:(0,we.jsx)(Z.A,{}),className:ye.notification}),e))).catch((e=>{console.error("Error:",e.message),J.$e.show({title:(0,d.__)("Error occured",x.TEXT_DOMAIN),message:e.message,color:"red",icon:(0,we.jsx)(V.A,{}),className:ye.notification})}))},onSuccess:()=>{De.invalidateQueries({queryKey:["sites",k]}),E(!1)},onError:e=>{J.$e.show({title:(0,d.__)("Error occured",x.TEXT_DOMAIN),message:e.message,color:"red",icon:(0,we.jsx)(V.A,{}),className:ye.notification})}}),We=(0,xe.n)({mutationFn:async e=>{await j.yH({apiName:"backend",path:`/account/${k}/site/${e}`}).response},onMutate:async e=>{await De.cancelQueries({queryKey:["sites"]});const s=De.getQueryData(["sites"]);return De.setQueryData(["sites"],(s=>s?{...s,pages:s.pages.map((s=>({...s,list:s.list.filter((s=>s.siteId!==e))})))}:s)),{prev:s}},onSuccess:()=>{De.invalidateQueries({queryKey:["sites",k]}),_===n&&(A(void 0),z(void 0),W(void 0),G(void 0))}}),Me=(0,c.useMemo)((()=>{const e=3*(y-1);return _e?.slice(e,e+3)}),[_e,y]);return fe?(0,we.jsx)(Se,{}):(0,we.jsxs)(we.Fragment,{children:[ve?(0,we.jsxs)(m.E,{c:"red",children:["Error: ",ve?.message]}):(0,we.jsxs)(we.Fragment,{children:[(be?.length>1||!be.find((e=>e.accountId===k)))&&(0,we.jsx)(M.l,{label:"Select a workspace",description:"Select a workspace to manage sites",w:{base:"100%",xs:350},height:80,mb:"md",value:k,onChange:e=>{e&&(A(e),z(e===s?n:void 0),W(e===s?i:void 0),G(e===s?t:void 0),f(1),E(!1))},data:be.map((e=>({value:e.accountId,label:e.name}))),classNames:{dropdown:ye.dropdown}}),(0,we.jsxs)(O.s.Group,{label:"Select a site",description:"Select a site to connect this WordPress instance to",mb:"md",defaultValue:n+"|"+i+"|"+t,value:_+"|"+D+"|"+X,onChange:e=>{const s=e.split("|");z(s[0]),s.length>1&&W(s[1]),s.length>2&&G("true"===s[2])},children:[(0,we.jsxs)(I.Y,{gap:"xs",mt:"xs",children:[(0,we.jsx)(Y.I,{size:"xs",data:[{label:"Name",value:"name"},{label:"Domain",value:"domain"}],value:te,onChange:e=>ae(e)}),(0,we.jsx)($.k,{placeholder:"Filterâ€¦",size:"xs",value:H,onChange:e=>{ne(e.currentTarget.value),f(1)}})]}),(0,we.jsx)(g.E,{visible:Te||!!k&&"authenticated"===e&&(ke||l),mt:"md",mb:"md",children:(0,we.jsxs)(h.B,{pt:"md",mb:"md",gap:"xs",children:[(0,we.jsxs)(I.Y,{gap:"xs",style:{alignContent:"flex-start",overflowY:"auto"},children:[(!Me?.length||0===Me.length)&&!v&&(0,we.jsxs)(h.B,{align:"center",gap:"md",py:"xl",mb:"lg",w:{base:"100%",xs:350},children:[(0,we.jsx)(P.h,{order:4,children:"No Sites Found"}),(0,we.jsx)(m.E,{c:"dimmed",size:"sm",ta:"center",children:"You haven't added any sites yet."}),(0,we.jsx)(S.$,{variant:"gradient",size:"xs",leftSection:(0,we.jsx)(de.A,{size:16}),onClick:()=>{re.setValues({subscriptionType:"",siteId:"",name:"",domain:""}),E(!0)},children:"Add a new site"})]}),!v&&Me?.map((e=>(0,we.jsx)(O.s.Card,{className:ye.radioCard,component:"div",p:"md",radius:"md",value:e.siteId+"|"+e.siteKey+"|"+(void 0!==e.subscription),disabled:v,children:(0,we.jsxs)(I.Y,{wrap:"nowrap",align:"flex-start",children:[(0,we.jsx)(O.s.Indicator,{}),(0,we.jsxs)(h.B,{gap:"xs",style:{flexGrow:1},children:[(0,we.jsxs)(m.E,{component:"div",fw:700,lh:1.3,size:"md",c:"bright",children:[e.name,e.domain===location.hostname.split(":")[0]&&(0,we.jsx)(F.E,{size:"xs",ml:"xs",variant:"light",children:"Current domain"})]}),(0,we.jsxs)(m.E,{c:"dimmed",size:"xs",children:[e.domain," "]})]}),(0,we.jsx)(B.m,{label:"Edit site",children:(0,we.jsx)(N.M,{variant:"subtle",size:"xs","aria-label":"Edit site",onClick:s=>{s.stopPropagation(),re.setValues({subscriptionType:e.subscriptionType,siteId:e.siteId,name:e.name,domain:e.domain}),E(!0)},children:(0,we.jsx)(ue.A,{size:16})})}),(0,we.jsx)(B.m,{label:void 0!==e.subscriptionType?"Cannot delete site with active subscription":"Delete site",children:(0,we.jsx)(N.M,{variant:"subtle",size:"xs",color:"red","aria-label":void 0!==e.subscriptionType?"Cannot delete site with active subscription":"Delete site",disabled:void 0!==e.subscriptionType,onClick:s=>{s.stopPropagation(),Q.jQ.openConfirmModal({children:(0,we.jsxs)(we.Fragment,{children:[(0,we.jsxs)(w.D,{level:3,marginBottom:"var(--mantine-spacing-md)",children:["Delete ",e.name,"?"]})," ",(0,we.jsx)(m.E,{mb:"sm",children:"This site does not have an active subscription, but it may still contain saved configuration settings from another WordPress instance."}),(0,we.jsx)(m.E,{mb:"sm",children:"Deleting this site will permanently remove all saved settings, and this action cannot be undone."}),(0,we.jsx)(m.E,{fw:500,children:"Are you sure you want to delete this site?"})]}),labels:{confirm:"Yes, Delete",cancel:"No"},confirmProps:{className:ye["console-button"]},cancelProps:{variant:"outline",className:ye["console-button-outline"]},withCloseButton:!1,onConfirm:()=>We.mutate(e.siteId),zIndex:100002,xOffset:"1dvh",yOffset:"1dvh",centered:!0})},children:(0,we.jsx)(ie.A,{size:16})})})]})},e.siteId)))]}),!v&&(0,we.jsx)(K.d,{classNames:{root:ye.pagination,control:ye["pagination-control"]},total:Ae?Math.max(Ne,y+1):Ne,value:y,onChange:ze,mt:"md"}),v&&(0,we.jsxs)(T.Z,{component:"form",withBorder:!0,w:{base:"100%",xs:350},onSubmit:re.onSubmit((e=>{Fe.mutate({siteId:e.siteId,name:e.name,domain:e.domain})})),children:[(0,we.jsx)(q.p,{visible:Fe.isPending,zIndex:1e3,overlayProps:{radius:"md",blur:2}}),(0,we.jsx)(R.s,{children:(0,we.jsx)($.k,{...re.getInputProps("siteId")},re.key("siteId"))}),(0,we.jsx)($.k,{label:"Site name",placeholder:"My WordPress site",required:!0,...re.getInputProps("name")},re.key("name")),(0,we.jsx)($.k,{label:"Licensed Domain",placeholder:"my-wordpress-site.com",required:!0,...re.getInputProps("domain")},re.key("domain")),(0,we.jsxs)(I.Y,{justify:"space-between",mt:"md",children:[(0,we.jsx)(S.$,{variant:"outline",size:"xs",leftSection:(0,we.jsx)(he.A,{size:16}),onClick:()=>E(!1),children:"Cancel"}),(0,we.jsx)(C.s,{gap:0,children:(0,we.jsx)(S.$,{type:"submit",variant:"gradient",size:"xs",leftSection:(0,we.jsx)(me.A,{size:16}),children:"Save"})})]})]}),Me&&(0,we.jsx)(I.Y,{justify:"center",children:(0,we.jsx)(S.$,{variant:"subtle",size:"xs",leftSection:(0,we.jsx)(de.A,{size:16}),onClick:()=>{re.setValues({subscriptionType:"",siteId:"",name:"",domain:""}),E(!0)},disabled:v,children:"Add a new site"})})]})})]})]}),(0,we.jsxs)(I.Y,{justify:"space-between",children:[(0,we.jsx)(S.$,{variant:"outline",onClick:o,leftSection:(0,we.jsx)(se.A,{size:16}),children:"Close"}),(0,we.jsx)(S.$,{variant:"gradient",onClick:()=>{b(!0),r({accountId:k,siteId:_,siteKey:D,subscriber:X}).then((()=>{b(!1)}))},leftSection:(0,we.jsx)(ee.A,{size:16}),disabled:!!Ce||v,loading:p,children:"Connect"})]})]})}const Ce=e=>((0,c.useEffect)((()=>{const e=document.createElement("script");e.src="https://js.stripe.com/v3/pricing-table.js",e.async=!0,document.head.appendChild(e)}),[]),(0,we.jsx)(g.E,{visible:void 0===e.amplifyConfigured,width:"100%",mt:"md",children:(0,we.jsx)(Ee,{...e})}));n(428);const Pe="dev.wpsuite.io"===window.location.host?"https://api.wpsuite.io/dev":"https://api.wpsuite.io",Ae="dev.wpsuite.io"===window.location.host?"https://wpsuite.io/static/config/dev.json":"https://wpsuite.io/static/config/prod.json",Te=e=>{const{nonce:s}=e,[n,g]=(0,c.useState)(),[j,b]=(0,c.useState)(),[y,w]=(0,c.useState)(WpSuite.siteSettings.accountId),[f,v]=(0,c.useState)(WpSuite.siteSettings.siteId),[E,S]=(0,c.useState)(WpSuite.siteSettings.siteKey),I=(0,p.U)(`(max-width: ${u.S.breakpoints.sm})`),{data:k}=(0,a.I)({queryKey:["config"],queryFn:async()=>{const e=await fetch(Ae).catch((e=>({ok:!0,statusText:e.message,json:async()=>({config:"prod",baseUrl:"https://wpsuite.io",userPoolId:"us-east-1_G0wEwK9tt",identityPoolId:"us-east-1:11e55c9a-b768-48a2-8a0c-c51f1e99c129",appClientPlugin:"5e6fs3pk1k1ju7cgpnp7o7si8u",awsRegion:"us-east-1",pricingTable:"prctbl_1QA6TQFjw5MDUzy6c3fBSPGL",stripePublicKey:"pk_live_51OVeJwFjw5MDUzy6pwTbsMjcBZjZioihzLAtxQsF91u4lYJC4mtqrJddSskhz6OPbWS0tr8XL2G1AwJaXEpv9Rgn008dAz5TEr",permissions:{owner:["transfer-account","manage-account","manage-sites","manage-subscriptions","manage-billing"],admin:["manage-account","manage-sites","manage-subscriptions","manage-billing"],accountant:["manage-billing"]}})})));if(!e.ok)throw console.error("Error loading configuration:",await e.json()),g(!1),new Error(e.statusText);const s=await e.json(),n={Auth:{Cognito:{userPoolId:s.userPoolId,userPoolClientId:s.appClientPlugin,identityPoolId:s.identityPoolId}},API:{REST:{backend:{endpoint:Pe},backendWithIam:{endpoint:Pe}}}},t={API:{REST:{headers:async e=>{if("backend"===e.apiName)try{const e=await(0,i.$)();if(e?.tokens?.accessToken)return{Authorization:`Bearer ${e.tokens.accessToken}`}}catch(e){console.error(e)}return{}}}}};return o.E.configure(n,t),await C(),g(!0),s}}),C=(0,c.useCallback)((async()=>{try{var e;const s=await(0,i.$)(),n=null!==(e=s.tokens?.accessToken.payload.scope?.split(" "))&&void 0!==e?e:[];if(b(void 0),y&&!n.includes("sc.account.owner."+y)&&!n.includes("sc.account.admin."+y)){console.error("You do not have permission to access this resource. Please contact site owner.");const e=n.find((e=>e.startsWith("sc.account.owner.")||e.startsWith("sc.account.admin.")))?.split(".")[3];e&&b(e)}}catch(e){console.error(e),b(void 0)}}),[y]);return(0,c.useEffect)((()=>{const e=r.YZ.listen("auth",(e=>{const{payload:s}=e;"signedIn"!==s.event&&"signedOut"!==s.event||C()}));return()=>{e()}}),[C]),void 0!==n&&(0,we.jsx)(t.k.Provider,{children:(0,we.jsxs)("div",{className:"j7QpPcqW2jckSg1DEubK",children:[(0,we.jsxs)(h.B,{mb:"md",gap:4,children:[(0,we.jsx)(l.__experimentalHeading,{level:1,style:{display:"flex",alignItems:"center",gap:"8px",color:"#218BE6"},children:(0,d.__)(I?"WPSuite.io HUB":"Central Hub for WPSuite.io Plugins",x.TEXT_DOMAIN)}),(0,we.jsx)(m.E,{children:"Link this WordPress installation to your WP Suite workspace to enable licensing and shared features. You can disconnect or switch workspaces at any time without affecting your content."})]})," ",(0,we.jsx)(Ce,{apiUrl:Pe,amplifyConfigured:n,nonce:s,stripePublicKey:k?.stripePublicKey,pricingTable:k?.pricingTable,accountId:y,ownAccountId:null!=j?j:y,siteId:f,siteKey:E,setAccountId:w,setSiteId:v,setSiteKey:S})]})})}}}]);