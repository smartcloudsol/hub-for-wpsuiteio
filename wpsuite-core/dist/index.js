var O=Object.defineProperty;var l=(e,t)=>()=>(e&&(t=e(e=0)),t);var X=(e,t)=>{for(var n in t)O(e,n,{get:t[n],enumerable:!0})};function d(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");for(;t.length%4;)t+="=";return Uint8Array.from(atob(t),n=>n.charCodeAt(0))}var m,G,f=l(()=>{"use strict";m=(e,t)=>{let r=Uint8Array.from(atob(e),i=>i.charCodeAt(0)).map((i,o)=>i^t+o&255);return new TextDecoder().decode(r)},G=async e=>{let t=globalThis.grecaptcha,n=e?t?.enterprise:void 0,r=n?.ready??t?.ready,i=n?.execute??t?.execute;if(typeof i!="function")return{execute:void 0};try{return typeof r=="function"&&await new Promise(o=>r(()=>o())),{execute:i}}catch{return{execute:void 0}}}});function b(e,t){return`wpsuite:${e}:${t}`}function I(e,t=8e3){return()=>new Promise(n=>{if(e.status==="available")return n("available");if(e.status==="error")return n("error");!e.status||e.status;let r=b(e.key,"ready"),i=b(e.key,"error"),o=()=>c("available"),s=()=>c("error"),a,c=p=>{window.removeEventListener(r,o),window.removeEventListener(i,s),a!==void 0&&window.clearTimeout(a),n(p)};window.addEventListener(r,o,{once:!0}),window.addEventListener(i,s,{once:!0}),a=window.setTimeout(()=>c("unavailable"),t)})}function M(e){return t=>{window.addEventListener(b(e,"ready"),()=>t(),{once:!0})}}function Y(e,t){let n=t?.timeoutMs??8e3;return e.availability??=I(e,n),e.onReady??=M(e.key),e}var S=l(()=>{"use strict"});var h,P,x=l(()=>{"use strict";f();h=m("d3d+aVBPT0wbE3NbRkkFVUZiZFxEfAlPZVQJVWQMJDIaKCgrNBQaLABzKw==",34),P=m("dRdmX2FUUmpFT0hsTVpDXnBKRnF9eFNhSF8EcnFeHw4mIhw3Hg88PXo7GQ==",34)});var k={};X(k,{getConfig:()=>ee});import{importJWK as N,jwtVerify as V}from"jose";import{parse as F}from"tldts";function v(e){try{return new URL(e.includes("://")?e:`http://${e}`).hostname.toLowerCase()}catch{return e.replace(/\/+$/,"").toLowerCase()}}function Z(e){let t=v(e);return t.startsWith("www.")?t.slice(4):t}function A(e){let t=v(e);if(J.test(t)||$.test(t)||t==="localhost")return!0;let n=F(t,{allowPrivateDomains:!0});return!!(!n.domain||!n.publicSuffix||H.includes(n.publicSuffix))}function j(e){let t=v(e);return A(t)||E.test(t)?!0:t.split(".").some(n=>E.test(n))}function z(e){return A(e)||j(e)}function q(e,t){return t?Z(e)===t:!1}function Q(e,t){return z(e)?{free:!0,covered:!0}:{free:!1,covered:q(e,t)}}var _,R,u,w,E,H,J,$,ee,C=l(()=>{"use strict";x();f();W();u=T();u?w=u.siteSettings:w={};E=/\b(dev|test|testing|staging|stage|qa|uat|preview|demo|sandbox|preprod|beta|canary)\b/i,H=["localhost","local","test","invalid","example","lan","internal"],J=/^(127\.)|^(10\.)|^(192\.168\.)|^(172\.(1[6-9]|2\d|3[0-1])\.)/,$=/^(::1$)|(^fc00:)|(^fd)/i;ee=async()=>{let e=null;if(w.subscriber){let n=await N({kty:"EC",x:_,y:R,crv:"P-256"},"ES256"),r=new Date().getFullYear(),i=Math.floor((Date.now()-new Date(r,0,1).getTime())/(1e3*60*60*24*7)),o=await fetch(u.uploadUrl+"lic.jws?t="+u.siteSettings.lastUpdate+"&y="+r+"&w="+i).then(s=>s.ok?s.text():null).catch(()=>null);if(o)try{let s=location.hostname.split(":")[0],{payload:a}=await V(o,n,{algorithms:["ES256"]}),c=Q(s,a.domain);if(!c.free&&!c.covered)throw new Error("Invalid domain in JWT");let p=a.key.split(":"),L=d(p[0]),B=d(p[1]),y=(await fetch(u.uploadUrl+"config.enc?t="+u.siteSettings.lastUpdate).then(g=>g.ok?g.text():null).catch(()=>null))?.split(":");if(y?.length===2){let g=d(y[0]),U=d(y[1]),K=await crypto.subtle.importKey("raw",L,{name:"AES-GCM"},!1,["decrypt"]),D=await crypto.subtle.decrypt({name:"AES-GCM",iv:B},K,new Uint8Array([...g,...U]));e=JSON.parse(new TextDecoder().decode(D)),e.subscriptionType=a.subscriptionType}}catch(s){console.error(s.message)}}return e??null};_=h;R=P});function T(){return globalThis.WpSuite}function pe(e){return globalThis.WpSuite?.plugins[e]}var ge,fe,W=l(()=>{f();S();ge="hub-for-wpsuiteio",fe=async e=>{let n=await(await Promise.resolve().then(()=>(C(),k))).getConfig();return n&&(n={...n[e],subscriptionType:n.subscriptionType}),n}});W();export{ge as TEXT_DOMAIN,Y as attachDefaultPluginRuntime,fe as getConfig,pe as getPlugin,G as getRecaptcha,T as getWpSuite};
