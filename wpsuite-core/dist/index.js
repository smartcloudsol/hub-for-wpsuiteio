var O=Object.defineProperty;var l=(t,e)=>()=>(t&&(e=t(t=0)),e);var X=(t,e)=>{for(var n in e)O(t,n,{get:e[n],enumerable:!0})};function y(t,e){return`wpsuite:${t}:${e}`}function I(t,e=8e3){return()=>new Promise(n=>{if(t.status==="available")return n("available");if(t.status==="error")return n("error");!t.status||t.status;let o=y(t.key,"ready"),r=y(t.key,"error"),s=()=>u("available"),i=()=>u("error"),a,u=p=>{window.removeEventListener(o,s),window.removeEventListener(r,i),a!==void 0&&window.clearTimeout(a),n(p)};window.addEventListener(o,s,{once:!0}),window.addEventListener(r,i,{once:!0}),a=window.setTimeout(()=>u("unavailable"),e)})}function M(t){return e=>{window.addEventListener(y(t,"ready"),()=>e(),{once:!0})}}function Y(t,e){let n=e?.timeoutMs??8e3;return t.availability??=I(t,n),t.onReady??=M(t.key),t}var v=l(()=>{"use strict"});function d(t){let e=t.replace(/-/g,"+").replace(/_/g,"/");for(;e.length%4;)e+="=";return Uint8Array.from(atob(e),n=>n.charCodeAt(0))}var b,m=l(()=>{"use strict";b=(t,e)=>{let o=Uint8Array.from(atob(t),r=>r.charCodeAt(0)).map((r,s)=>r^e+s&255);return new TextDecoder().decode(o)}});var P,E,h=l(()=>{"use strict";m();P=b("MzMyJRwDCwhfVy8HGhVBEQImKBAIME0LIRC16diw4Pbe7OTn+Nje6MS39w==",102),E=b("MVMqEy0YFi4BCxQwEQYHGjQOCj0xNBclDBu4zs3i28ri5tD70sP4+b7/xQ==",102)});var k={};X(k,{getConfig:()=>Q});import{importJWK as G,jwtVerify as N}from"jose";import{parse as V}from"tldts";function S(t){try{return new URL(t.includes("://")?t:`http://${t}`).hostname.toLowerCase()}catch{return t.replace(/\/+$/,"").toLowerCase()}}function Z(t){let e=S(t);return e.startsWith("www.")?e.slice(4):e}function R(t){let e=S(t);if(J.test(e)||$.test(e)||e==="localhost")return!0;let n=V(e,{allowPrivateDomains:!0});return!!(!n.domain||!n.publicSuffix||H.includes(n.publicSuffix))}function j(t){let e=S(t);return R(e)||_.test(e)?!0:e.split(".").some(n=>_.test(n))}function z(t){return R(t)||j(t)}function F(t,e){return e?Z(t)===e:!1}function q(t,e){return z(t)?{free:!0,covered:!0}:{free:!1,covered:F(t,e)}}var x,A,c,w,_,H,J,$,Q,C=l(()=>{"use strict";h();m();W();c=T();c?w=c.siteSettings:w={};_=/\b(dev|test|testing|staging|stage|qa|uat|preview|demo|sandbox|preprod|beta|canary)\b/i,H=["localhost","local","test","invalid","example","lan","internal"],J=/^(127\.)|^(10\.)|^(192\.168\.)|^(172\.(1[6-9]|2\d|3[0-1])\.)/,$=/^(::1$)|(^fc00:)|(^fd)/i;Q=async()=>{let t=null;if(w.subscriber){let n=await G({kty:"EC",x,y:A,crv:"P-256"},"ES256"),o=new Date().getFullYear(),r=Math.floor((Date.now()-new Date(o,0,1).getTime())/(1e3*60*60*24*7)),s=await fetch(c.uploadUrl+"lic.jws?t="+c.siteSettings.lastUpdate+"&y="+o+"&w="+r).then(i=>i.ok?i.text():null).catch(()=>null);if(s)try{let i=location.hostname.split(":")[0],{payload:a}=await N(s,n,{algorithms:["ES256"]}),u=q(i,a.domain);if(!u.free&&!u.covered)throw new Error("Invalid domain in JWT");let p=a.key.split(":"),L=d(p[0]),B=d(p[1]),f=(await fetch(c.uploadUrl+"config.enc?t="+c.siteSettings.lastUpdate).then(g=>g.ok?g.text():null).catch(()=>null))?.split(":");if(f?.length===2){let g=d(f[0]),U=d(f[1]),K=await crypto.subtle.importKey("raw",L,{name:"AES-GCM"},!1,["decrypt"]),D=await crypto.subtle.decrypt({name:"AES-GCM",iv:B},K,new Uint8Array([...g,...U]));t=JSON.parse(new TextDecoder().decode(D)),t.subscriptionType=a.subscriptionType}}catch(i){console.error(i.message)}}return t??null};x=P;A=E});function T(){return globalThis.WpSuite}function dt(t){return globalThis.WpSuite?.plugins[t]}var pt,gt,W=l(()=>{v();pt="hub-for-wpsuiteio",gt=async t=>{let n=await(await Promise.resolve().then(()=>(C(),k))).getConfig();return n&&(n={...n[t],subscriptionType:n.subscriptionType}),n}});W();export{pt as TEXT_DOMAIN,Y as attachDefaultPluginRuntime,gt as getConfig,dt as getPlugin,T as getWpSuite};
