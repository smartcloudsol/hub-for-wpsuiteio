var L=Object.defineProperty;var p=(t,e)=>()=>(t&&(e=t(t=0)),e);var W=(t,e)=>{for(var n in e)L(t,n,{get:e[n],enumerable:!0})};function i(t){let e=t.replace(/-/g,"+").replace(/_/g,"/");for(;e.length%4;)e+="=";return Uint8Array.from(atob(e),n=>n.charCodeAt(0))}var f,d=p(()=>{"use strict";f=(t,e)=>{let s=Uint8Array.from(atob(t),o=>o.charCodeAt(0)).map((o,a)=>o^e+a&255);return new TextDecoder().decode(s)}});var b,S,_=p(()=>{"use strict";d();b=f("XV1QR3plaWohKU1lfHMjc2xISnJuVi9pf04XS34WQlRwQkZFXn58SnoJVQ==",8),S=f("Xz1IcUt+dEx/dXZSd2BleFpgaF9XUnVHUkUabGtEeWhMSHJZdGVaWwBBZw==",8)});var P={};W(P,{getConfig:()=>J});import{importJWK as B,jwtVerify as K}from"jose";import{parse as X}from"tldts";function y(t){try{return new URL(t.includes("://")?t:`http://${t}`).hostname.toLowerCase()}catch{return t.replace(/\/+$/,"").toLowerCase()}}function Y(t){let e=y(t);return e.startsWith("www.")?e.slice(4):e}function A(t){let e=y(t);if(O.test(e)||I.test(e)||e==="localhost")return!0;let n=X(e,{allowPrivateDomains:!0});return!!(!n.domain||!n.publicSuffix||D.includes(n.publicSuffix))}function N(t){let e=y(t);return A(e)||h.test(e)?!0:e.split(".").some(n=>h.test(n))}function M(t){return A(t)||N(t)}function G(t,e){return e?Y(t)===e:!1}function H(t,e){return M(t)?{free:!0,covered:!0}:{free:!1,covered:G(t,e)}}var E,C,g,h,D,O,I,J,x=p(()=>{"use strict";_();d();typeof WpSuite<"u"?g=WpSuite.siteSettings:g={};h=/\b(dev|test|testing|staging|stage|qa|uat|preview|demo|sandbox|preprod|beta|canary)\b/i,D=["localhost","local","test","invalid","example","lan","internal"],O=/^(127\.)|^(10\.)|^(192\.168\.)|^(172\.(1[6-9]|2\d|3[0-1])\.)/,I=/^(::1$)|(^fc00:)|(^fd)/i;J=async()=>{let t=null;if(g.subscriber){let n=await B({kty:"EC",x:E,y:C,crv:"P-256"},"ES256"),s=new Date().getFullYear(),o=Math.floor((Date.now()-new Date(s,0,1).getTime())/(1e3*60*60*24*7)),a=await fetch(WpSuite.uploadUrl+"lic.jws?t="+WpSuite.siteSettings.lastUpdate+"&y="+s+"&w="+o).then(r=>r.ok?r.text():null).catch(()=>null);if(a)try{let r=location.hostname.split(":")[0],{payload:u}=await K(a,n,{algorithms:["ES256"]}),m=H(r,u.domain);if(!m.free&&!m.covered)throw new Error("Invalid domain in JWT");let w=u.key.split(":"),R=i(w[0]),T=i(w[1]),l=(await fetch(WpSuite.uploadUrl+"config.enc?t="+WpSuite.siteSettings.lastUpdate).then(c=>c.ok?c.text():null).catch(()=>null))?.split(":");if(l.length===2){let c=i(l[0]),U=i(l[1]),k=await crypto.subtle.importKey("raw",R,{name:"AES-GCM"},!1,["decrypt"]),v=await crypto.subtle.decrypt({name:"AES-GCM",iv:T},k,new Uint8Array([...c,...U]));t=JSON.parse(new TextDecoder().decode(v)),t.subscriptionType=u.subscriptionType}}catch(r){console.error(r.message)}}return t??null};E=b;C=S});var et="hub-for-wpsuiteio",nt=async t=>{let n=await(await Promise.resolve().then(()=>(x(),P))).getConfig();return n&&(n={...n[t],subscriptionType:n.subscriptionType}),n};export{et as TEXT_DOMAIN,nt as getConfig};
